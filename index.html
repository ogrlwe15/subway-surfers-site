<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subway Surfers by Mynvo</title>
  <meta name="description" content="Subway Surfers + Timer simple + Leaderboard manuel - Créé par Mynvo">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { font-family: 'Segoe UI', sans-serif; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; min-height: 100vh; display: flex; flex-direction: column; }
    header { background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); padding: 20px 40px; }
    .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 32px; font-weight: 900; display:flex; align-items:center; gap:12px; }
    .logo img { height: 48px; border-radius: 50%; border: 3px solid #ffd700; }
    .logo span { color: #ffd700; }
    .nav-links a { color: white; text-decoration: none; margin-left: 20px; font-weight: 600; }
    .nav-links a:hover { text-decoration: underline; }
    main { flex: 1; padding: 40px 20px; }
    .game-container { max-width: 1300px; margin: 0 auto; background: rgba(0,0,0,0.3); backdrop-filter: blur(20px); border-radius: 24px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
    h1 { font-size: 52px; text-align: center; margin-bottom: 20px; text-shadow: 0 4px 20px rgba(0,0,0,0.5); }
    .game-frame { position:relative; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
    iframe { width: 100%; height: 720px; border: none; }
    .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); text-align:center; z-index:2; }
    .spinner { width:60px; height:60px; border:6px solid #ffffff33; border-top-color:#ffd700; border-radius:50%; animation:spin 1s linear infinite; margin-bottom:20px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    footer { text-align:center; padding:30px; opacity:0.8; font-size:14px; }
    .credit { color:#ffd700; font-weight:bold; }
  </style>
</head>
<body>

  <header>
    <div class="header-content">
      <div class="logo">
        <img src="logo.png" alt="Mynvo">
        Subway<span>Surfers</span> by <span class="credit">Mynvo</span>
      </div>
      <div class="nav-links">
        <a href="#game">Jouer</a>
        <a href="#settings" onclick="openSettings()">Paramètres</a>
      </div>
    </div>
  </header>

  <main>
    <div class="game-container">
      <h1>Subway Surfers – Timer + Leaderboard Manuel</h1>
      <div class="game-frame">
        <div class="loading">
          <div class="spinner"></div>
          <p>Chargement du jeu...</p>
        </div>
        <iframe src="./game/" 
                allowfullscreen 
                allow="autoplay; fullscreen *; gyroscope; accelerometer" 
                style="width:100%; height:720px; border:none;" 
                onload="this.parentElement.querySelector('.loading').style.display='none'">
        </iframe>
      </div>
    </div>
  </main>

  <footer>
    © 2025 Subway Surfers by Mynvo – Jeu original © SYBO & Kiloo
  </footer>

  <script>
    // === CONFIG JOUEUR ===
    const defaultConfig = { up:"z", down:"s", left:"q", right:"d", jump:" ", name:"Joueur" };
    let config = JSON.parse(localStorage.getItem("mynvoConfig")) || defaultConfig;
    function saveConfig(){ localStorage.setItem("mynvoConfig", JSON.stringify(config)); }

    // === REMAP TOUCHES ===
    const keyMap = { [config.up.toLowerCase()]:38, [config.down.toLowerCase()]:40, [config.left.toLowerCase()]:37, [config.right.toLowerCase()]:39, [config.jump.toLowerCase()]:32 };
    document.addEventListener("keydown", e => { const code = keyMap[e.key.toLowerCase()]; if(code){ e.preventDefault(); document.querySelector("iframe").contentWindow.postMessage({type:"key",code,event:"down"},"*");}});
    document.addEventListener("keyup",   e => { const code = keyMap[e.key.toLowerCase()]; if(code){ e.preventDefault(); document.querySelector("iframe").contentWindow.postMessage({type:"key",code,event:"up"},"*");}});

    // === INJECTION DANS LE JEU ===
    document.querySelector("iframe").addEventListener("load", () => {
      const iframe = document.querySelector("iframe");
      const script = iframe.contentDocument.createElement("script");
      script.textContent = `
        (() => {
          // TIMER (démarre dès le premier mouvement, reset à la mort)
          const timerDiv = document.createElement("div");
          timerDiv.style.cssText = "position:fixed;top:15px;left:15px;z-index:999999;background:#0d1117;color:#22c55e;padding:14px 24px;border-radius:12px;font-weight:bold;font-size:20px;border:3px solid #22c55e;box-shadow:0 0 25px #22c55e44;";
          timerDiv.textContent = "0:00";
          document.body.appendChild(timerDiv);

          let startTime = 0;
          let timerInterval = null;
          let gameStarted = false;

          function startTimer() {
            if (gameStarted) return;
            gameStarted = true;
            startTime = Date.now();
            timerInterval = setInterval(() => {
              const elapsed = Math.floor((Date.now() - startTime) / 1000);
              const mins = Math.floor(elapsed / 60);
              const secs = (elapsed % 60).toString().padStart(2, "0");
              timerDiv.textContent = mins + ":" + secs;
            }, 100);
          }

          function resetTimer() {
            gameStarted = false;
            clearInterval(timerInterval);
            timerDiv.textContent = "0:00";
          }

          // FPS
          const fpsDiv = document.createElement("div");
          fpsDiv.style.cssText = "position:fixed;top:15px;right:15px;z-index:999999;background:#0d1117;color:#58a6ff;padding:8px 14px;border-radius:12px;font-weight:bold;";
          fpsDiv.textContent = "FPS: --";
          document.body.appendChild(fpsDiv);
          let last = performance.now(), frames = 0;
          const updateFPS = () => { frames++; const now = performance.now(); if(now-last>=1000){ fpsDiv.textContent="FPS: "+Math.round(frames*1000/(now-last)); frames=0; last=now; } requestAnimationFrame(updateFPS); };
          updateFPS();

          // Leaderboard manuel (change ici quand tu veux)
          const leaderboard = document.createElement("div");
          leaderboard.style.cssText = "position:fixed;bottom:15px;left:15px;z-index:999999;background:#0d1117;color:#c9d1d9;padding:14px 22px;border-radius:12px;font-weight:bold;border:3px solid #ffd700;box-shadow:0 0 25px #ffd70044;font-size:16px;";
          leaderboard.innerHTML = "TROPHÉE TOP 3<br>1. Mynvo - 15:42<br>2. Shadow - 11:08<br>3. Ghost - 8:19";
          document.body.appendChild(leaderboard);

          // Indication touches
          const touches = document.createElement("div");
          touches.textContent = "ZQSD | SPACE";
          touches.style.cssText = "position:fixed;bottom:15px;right:15px;z-index:999999;background:#0d1117;color:#58a6ff;padding:8px 16px;border-radius:12px;font-weight:bold;border:1px solid #30363d;";
          document.body.appendChild(touches);

          // Détection départ et mort via le score
          let lastScore = 0;
          setInterval(() => {
            const scoreEl = document.querySelector("[class*='score'], [id*='score'], [class*='Score']");
            if (!scoreEl) return;
            const scoreText = scoreEl.textContent.replace(/[^0-9]/g, "");
            const currentScore = scoreText ? parseInt(scoreText) : 0;

            // Début de partie détecté
            if (currentScore > 100 && lastScore <= 100) startTimer();

            // Mort détectée (score retombe brutalement)
            if (currentScore < lastScore - 200) resetTimer();

            lastScore = currentScore;
          }, 300);
        })();
      `;
      iframe.contentDocument.head.appendChild(script);
    });

    // === FENÊTRE PARAMÈTRES (gros champs bien visibles) ===
    function openSettings(){
      if(document.getElementById("mynvo-settings")) return;
      const div = document.createElement("div");
      div.id = "mynvo-settings";
      div.style = "position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#0d1117;color:white;padding:40px;border-radius:20px;border:4px solid #ffd700;z-index:999999;max-width:90%;box-shadow:0 0 60px #000;";
      div.innerHTML = `
        <h2 style="color:#ffd700;text-align:center;margin-bottom:30px;font-size:28px;">Paramètres MYNVO</h2>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:20px;max-width:500px;margin:0 auto;font-size:18px;">
          <div><label style="display:block;margin-bottom:8px;">Pseudo</label><input value="${config.name}" id="set-name" style="width:100%;padding:14px;font-size:18px;background:#21262d;border:2px solid #30363d;border-radius:12px;color:white;"></div>
          <div><label style="display:block;margin-bottom:8px;">Haut</label><input maxlength=1 value="${config.up}" id="set-up" style="width:100%;padding:14px;font-size:18px;background:#21262d;border:2px solid #30363d;border-radius:12px;color:white;text-align:center;"></div>
          <div><label style="display:block;margin-bottom:8px;">Bas</label><input maxlength=1 value="${config.down}" id="set-down" style="width:100%;padding:14px;font-size:18px;background:#21262d;border:2px solid #30363d;border-radius:12px;color:white;text-align:center;"></div>
          <div><label style="display:block;margin-bottom:8px;">Gauche</label><input maxlength=1 value="${config.left}" id="set-left" style="width:100%;padding:14px;font-size:18px;background:#21262d;border:2px solid #30363d;border-radius:12px;color:white;text-align:center;"></div>
          <div><label style="display:block;margin-bottom:8px;">Droite</label><input maxlength=1 value="${config.right}" id="set-right" style="width:100%;padding:14px;font-size:18px;background:#21262d;border:2px solid #30363d;border-radius:12px;color:white;text-align:center;"></div>
          <div><label style="display:block;margin-bottom:8px;">Saut</label><input value="${config.jump === ' ' ? 'SPACE' : config.jump}" id="set-jump" style="width:100%;padding:14px;font-size:18px;background:#21262d;border:2px solid #30363d;border-radius:12px;color:white;text-align:center;"></div>
        </div>
        <div style="text-align:center;margin-top:30px;">
          <button onclick="this.closest('#mynvo-settings').remove()" style="background:#ef4444;color:white;padding:14px 28px;border:none;border-radius:12px;cursor:pointer;font-size:18px;">Fermer</button>
          <button onclick="saveMynvoSettings()" style="background:#22c55e;color:white;padding:14px 40px;border:none;border-radius:12px;cursor:pointer;margin-left:20px;font-size:18px;">Enregistrer</button>
        </div>
      `;
      document.body.appendChild(div);
    }

    function saveMynvoSettings(){
      config.name = document.getElementById("set-name").value || "Joueur";
      config.up = document.getElementById("set-up").value || "z";
      config.down = document.getElementById("set-down").value || "s";
      config.left = document.getElementById("set-left").value || "q";
      config.right = document.getElementById("set-right").value || "d";
      config.jump = document.getElementById("set-jump").value.toUpperCase() === "SPACE" ? " " : document.getElementById("set-jump").value;
      saveConfig();
      alert("Sauvegardé ! Recharge la page pour que les touches soient appliquées.");
      document.getElementById("mynvo-settings").remove();
    }
  </script>
</body>
</html>
