<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Subway Surfers by Mynvo</title>
  <meta name="description" content="Subway Surfers + Mode NO COIN + Leaderboard mondial - Cr√©√© par Mynvo">
  <style>
    * { margin:0; padding:0; box-sizing:border-box; }
    body { 
      font-family: 'Segoe UI', sans-serif; 
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
      color: white; min-height: 100vh; display: flex; flex-direction: column;
    }
    header { background: rgba(0,0,0,0.3); backdrop-filter: blur(10px); padding: 20px 40px; }
    .header-content { max-width: 1400px; margin: 0 auto; display: flex; justify-content: space-between; align-items: center; }
    .logo { font-size: 32px; font-weight: 900; display:flex; align-items:center; gap:12px; }
    .logo img { height: 48px; border-radius: 50%; border: 3px solid #ffd700; }
    .logo span { color: #ffd700; }
    .nav-links a { color: white; text-decoration: none; margin-left: 20px; font-weight: 600; }
    .nav-links a:hover { text-decoration: underline; }
    main { flex: 1; padding: 40px 20px; }
    .game-container { max-width: 1300px; margin: 0 auto; background: rgba(0,0,0,0.3); backdrop-filter: blur(20px); border-radius: 24px; padding: 40px; box-shadow: 0 20px 60px rgba(0,0,0,0.4); }
    h1 { font-size: 52px; text-align: center; margin-bottom: 20px; text-shadow: 0 4px 20px rgba(0,0,0,0.5); }
    .game-frame { position:relative; border-radius: 16px; overflow: hidden; box-shadow: 0 10px 40px rgba(0,0,0,0.5); }
    iframe { width: 100%; height: 720px; border: none; }
    .loading { position: absolute; top: 50%; left: 50%; transform: translate(-50%,-50%); text-align:center; z-index:2; }
    .spinner { width:60px; height:60px; border:6px solid #ffffff33; border-top-color:#ffd700; border-radius:50%; animation:spin 1s linear infinite; margin-bottom:20px; }
    @keyframes spin { to { transform: rotate(360deg); } }
    footer { text-align:center; padding:30px; opacity:0.8; font-size:14px; }
    .credit { color:#ffd700; font-weight:bold; }
  </style>
</head>
<body>

  <header>
    <div class="header-content">
      <div class="logo">
        <img src="logo.png" alt="Mynvo">
        Subway<span>Surfers</span> by <span class="credit">Mynvo</span>
      </div>
      <div class="nav-links">
        <a href="#game">Jouer</a>
        <a href="#settings" onclick="openSettings()">‚öôÔ∏è Param√®tres</a>
      </div>
    </div>
  </header>

  <main>
    <div class="game-container">
      <h1>Subway Surfers ‚Äì Mode NO COIN + Leaderboard Mondial</h1>
      <div class="game-frame">
        <div class="loading">
          <div class="spinner"></div>
          <p>Chargement du jeu...</p>
        </div>
        <iframe src="game/index.html" allowfullscreen onload="this.parentElement.querySelector('.loading').style.display='none'"></iframe>
      </div>
      <p style="text-align:center; margin-top:30px; font-size:18px;">
        Toutes les fonctionnalit√©s MYNVO (NO COIN, leaderboard, touches perso, FPS) sont <strong>int√©gr√©es directement</strong> ‚Äì aucune extension √† installer !
      </p>
    </div>
  </main>

  <footer>
    ¬© 2024 Subway Surfers by Mynvo ‚Äì Jeu original ¬© SYBO & Kiloo
  </footer>

  <!-- TOUT LE CODE MYNVO INT√âGR√â (ex-extension) -->
  <script>
    // === CONFIG JOUEUR (localStorage) ===
    const defaultConfig = { up:"z", down:"s", left:"q", right:"d", jump:" ", name:"Joueur", fps:true };
    let config = JSON.parse(localStorage.getItem("mynvoConfig")) || defaultConfig;
    function saveConfig(){ localStorage.setItem("mynvoConfig", JSON.stringify(config)); }

    // === REDIRECTION TOUCHES ===
    const keyMap = { [config.up.toLowerCase()]:38, [config.down.toLowerCase()]:40, [config.left.toLowerCase()]:37, [config.right.toLowerCase()]:39, [config.jump.toLowerCase()]:32 };
    document.addEventListener("keydown", e => {
      const code = keyMap[e.key.toLowerCase()];
      if(code){
        e.preventDefault();
        const iframe = document.querySelector("iframe");
        if(iframe) iframe.contentWindow.postMessage({type:"key", code, event:"down"}, "*");
      }
    });
    document.addEventListener("keyup", e => {
      const code = keyMap[e.key.toLowerCase()];
      if(code){
        e.preventDefault();
        const iframe = document.querySelector("iframe");
        if(iframe) iframe.contentWindow.postMessage({type:"key", code, event:"up"}, "*");
      }
    });

    // === INJECTION DANS L'IFRAME ===
    document.querySelector("iframe").addEventListener("load", () => {
      const iframe = document.querySelector("iframe");
      const script = iframe.contentDocument.createElement("script");
      script.textContent = \`
        (() => {
          console.log("%cMYNVO ACTIV√â ‚Äì TOP3 MONDIAL + NO COIN", "color:#58a6ff;font-size:22px;font-weight:bold");
          function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = seconds % 60;
            return \`\${mins}:\${secs.toString().padStart(2, '0')}\`;
          }
          const FIREBASE_URL = "https://mynvo-nocoin-default-rtdb.europe-west1.firebasedatabase.app";
          const firebaseGet = async () => {
            try {
              const res = await fetch(\`\${FIREBASE_URL}/leaderboard.json\`);
              if (!res.ok) return null;
              return await res.json();
            } catch (e) {
              return null;
            }
          };
          const firebasePost = async (name, time) => {
            try {
              const res = await fetch(\`\${FIREBASE_URL}/leaderboard.json\`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ name, time, timestamp: Date.now() })
              });
              if (!res.ok) return null;
              return await res.json();
            } catch (e) {
              return null;
            }
          };
          window.addEventListener("message", e => {
            if (e.data.type === "key") {
              const eventType = e.data.event === "down" ? "keydown" : "keyup";
              const ke = new KeyboardEvent(eventType, { keyCode: e.data.code, bubbles: true });
              document.dispatchEvent(ke);
            }
          });
          const wait = setInterval(() => {
            const canvas = document.querySelector("canvas");
            if (!canvas) return;
            clearInterval(wait);
            const touches = document.createElement("div");
            touches.textContent = "ZQSD | SPACE";
            touches.style.cssText = "position:fixed;bottom:15px;right:15px;z-index:999999999;background:#0d1117;color:#58a6ff;padding:8px 16px;border-radius:12px;font-weight:bold;border:1px solid #30363d;box-shadow:0 0 15px #58a6ff33;pointer-events:none;font-size:14px;";
            document.body.appendChild(touches);
            const fpsCounter = document.createElement("div");
            fpsCounter.id = "fps-counter";
            fpsCounter.style.cssText = "position:fixed;top:15px;left:15px;z-index:999999999;background:#0d1117;color:#22c55e;padding:10px 18px;border-radius:12px;font-weight:bold;border:1px solid #30363d;box-shadow:0 0 15px #22c55e33;cursor:pointer;pointer-events:auto;";
            fpsCounter.textContent = "FPS: --";
            fpsCounter.onclick = () => fpsCounter.style.display = fpsCounter.style.display === "none" ? "block" : "none";
            document.body.appendChild(fpsCounter);
            let lastTime = performance.now();
            let frameCount = 0;
            const updateFPS = () => {
              frameCount++;
              const now = performance.now();
              if (now - lastTime >= 1000) {
                fpsCounter.textContent = \`FPS: \${Math.round(frameCount / ((now - lastTime) / 1000))}\`;
                frameCount = 0;
                lastTime = now;
              }
              requestAnimationFrame(updateFPS);
            };
            updateFPS();
            const leaderboard = document.createElement("div");
            leaderboard.style.cssText = "position:fixed;bottom:15px;left:15px;z-index:999999999;background:#0d1117;color:#c9d1d9;padding:12px 20px;border-radius:12px;font-weight:bold;border:1px solid #30363d;box-shadow:0 0 15px #ffd70033;max-height:200px;overflow-y:auto;";
            leaderboard.innerHTML = "üèÜ TOP 3<br>Chargement...";
            document.body.appendChild(leaderboard);
            const updateLeaderboard = async () => {
              const data = await firebaseGet();
              if (!data) return;
              const scores = Object.values(data || {}).sort((a, b) => b.time - a.time).slice(0, 3);
              leaderboard.innerHTML = "üèÜ TOP 3<br>" + scores.map((s, i) => \`\${i + 1}. \${s.name} - \${formatTime(s.time)}\`).join("<br>");
            };
            updateLeaderboard();
            setInterval(updateLeaderboard, 10000);
            const coinIndicator = document.createElement("div");
            coinIndicator.style.cssText = "position:fixed;top:15px;left:15px;z-index:999999999;background:#0d1117;color:#22c55e;padding:12px 20px;border-radius:12px;font-weight:bold;border:1px solid #30363d;box-shadow:0 0 15px #22c55e33;transition:opacity 0.5s;opacity:0;";
            document.body.appendChild(coinIndicator);
            let isGameRunning = false;
            let gameStartTime = 0;
            let bestNoCoinTime = 0;
            let hasCollectedCoin = false;
            let runStartCoinCount = 0;
            let previousCoinCount = 0;
            let timerInterval = null;
            const checkGame = () => {
              const scoreElements = document.querySelectorAll("[class*='score'], [id*='score'], [class*='coin'], [id*='coin']");
              let currentCoinCount = 0;
              scoreElements.forEach(el => {
                const text = el.textContent.trim();
                if (/^\\d+$/.test(text)) currentCoinCount = parseInt(text);
              });
              if (currentCoinCount > previousCoinCount && !isGameRunning) {
                isGameRunning = true;
                gameStartTime = Date.now();
                bestNoCoinTime = 0;
                hasCollectedCoin = false;
                runStartCoinCount = currentCoinCount;
                coinIndicator.style.opacity = "1";
                coinIndicator.style.color = "#22c55e";
                coinIndicator.style.borderColor = "#22c55e";
                coinIndicator.innerHTML = 'NO COIN | <span id="run-timer">0:00</span><br><small style="font-size:11px;color:#58a6ff;">Record: <span id="best-time">0:00</span></small>';
                timerInterval = setInterval(() => {
                  if (!isGameRunning) {
                    clearInterval(timerInterval);
                    return;
                  }
                  const elapsed = Math.floor((Date.now() - gameStartTime) / 1000);
                  document.getElementById('run-timer').textContent = formatTime(elapsed);
                  if (currentCoinCount === runStartCoinCount && elapsed > bestNoCoinTime) {
                    bestNoCoinTime = elapsed;
                    document.getElementById('best-time').textContent = formatTime(bestNoCoinTime);
                  }
                }, 1000);
              }
              if (isGameRunning && currentCoinCount > runStartCoinCount && !hasCollectedCoin) {
                hasCollectedCoin = true;
                coinIndicator.style.borderColor = '#ef4444';
                coinIndicator.style.color = '#ef4444';
                coinIndicator.innerHTML = '‚ùå PI√àCE COLLECT√âE !<br><small style="font-size:11px;color:#58a6ff;">Temps avant: ' + formatTime(bestNoCoinTime) + '</small>';
                if (bestNoCoinTime >= 5) firebasePost("${config.name}", bestNoCoinTime);
              }
              if (isGameRunning && previousCoinCount > currentCoinCount + 50) {
                if (!hasCollectedCoin && bestNoCoinTime >= 5) firebasePost("${config.name}", bestNoCoinTime);
                isGameRunning = false;
                clearInterval(timerInterval);
                setTimeout(() => coinIndicator.style.opacity = '0', 3000);
              }
              previousCoinCount = currentCoinCount;
            };
            setInterval(checkGame, 100);
          }, 100);
        })();
      \`;
      iframe.contentDocument.head.appendChild(script);
    });

    // === FEN√äTRE PARAM√àTRES ===
    function openSettings(){
      if(document.getElementById("mynvo-settings")) return;
      const div = document.createElement("div");
      div.id = "mynvo-settings";
      div.style = "position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:#0d1117;color:white;padding:30px;border-radius:20px;border:3px solid #ffd700;z-index:999999;max-width:90%;box-shadow:0 0 50px #000;";
      div.innerHTML = `
        <h2 style="color:#ffd700;text-align:center;margin-bottom:20px;">Param√®tres MYNVO</h2>
        <div style="display:grid;grid-template-columns:1fr 1fr;gap:15px;max-width:400px;margin:0 auto;">
          <div><label>Pseudo</label><input value="${config.name}" id="set-name" style="width:100%;padding:8px;margin-top:5px;background:#21262d;border:1px solid #30363d;border-radius:8px;color:white;"></div>
          <div><label>Haut</label><input maxlength=1 value="${config.up}" id="set-up"></div>
          <div><label>Bas</label><input maxlength=1 value="${config.down}" id="set-down"></div>
          <div><label>Gauche</label><input maxlength=1 value="${config.left}" id="set-left"></div>
          <div><label>Droite</label><input maxlength=1 value="${config.right}" id="set-right"></div>
          <div><label>Saut</label><input value="${config.jump === ' ' ? 'SPACE' : config.jump}" id="set-jump"></div>
        </div>
        <div style="text-align:center;margin-top:20px;">
          <button onclick="this.closest('#mynvo-settings').remove()" style="background:#ef4444;color:white;padding:10px 20px;border:none;border-radius:8px;cursor:pointer;">Fermer</button>
          <button onclick="saveMynvoSettings()" style="background:#22c55e;color:white;padding:10px 30px;border:none;border-radius:8px;cursor:pointer;margin-left:10px;">Enregistrer</button>
        </div>
      `;
      document.body.appendChild(div);
    }

    function saveMynvoSettings(){
      config.name = document.getElementById("set-name").value || "Joueur";
      config.up = document.getElementById("set-up").value || "z";
      config.down = document.getElementById("set-down").value || "s";
      config.left = document.getElementById("set-left").value || "q";
      config.right = document.getElementById("set-right").value || "d";
      config.jump = document.getElementById("set-jump").value.toUpperCase() === "SPACE" ? " " : document.getElementById("set-jump").value;
      saveConfig();
      alert("Sauvegard√© ! Recharge la page pour appliquer.");
      document.getElementById("mynvo-settings").remove();
    }
  </script>
</body>
</html>