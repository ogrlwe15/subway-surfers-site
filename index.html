<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Subway Surfers by Mynvo - Jeu en ligne gratuit</title>
  <style>
    :root {
      --primary: #7c62dc;
      --bg-dark: #0a0a0a;
      --bg-card: rgba(30, 30, 40, 0.8);
      --text-light: #f0f0f0;
      --success: #00cc66;
      --danger: #ff4444;
      --warning: #ffaa00;
    }
    
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: var(--text-light);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
    }
    
    header {
      background: rgba(124, 98, 220, 0.15);
      backdrop-filter: blur(12px);
      padding: 18px 40px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      border-bottom: 2px solid var(--primary);
    }
    
    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .logo {
      font-size: 34px;
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 14px;
    }
    
    .logo span {
      color: var(--primary);
    }
    
    .nav-links {
      display: flex;
      gap: 24px;
    }
    
    .nav-links a {
      color: #fff;
      text-decoration: none;
      font-weight: 600;
      transition: color 0.2s;
      cursor: pointer;
    }
    
    .nav-links a:hover {
      color: var(--primary);
    }
    
    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 120px 20px 40px;
    }
    
    .game-container {
      width: 100%;
      max-width: 1350px;
      background: var(--bg-card);
      backdrop-filter: blur(20px);
      border-radius: 28px;
      padding: 40px;
      border: 2px solid var(--primary);
    }
    
    .game-frame {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      border: 2px solid var(--primary);
    }
    
    iframe {
      width: 100%;
      height: 720px;
      border: none;
      background: #000000;
      display: block;
    }
    
    /* CRITICAL: Overlays TOUJOURS visibles m√™me en fullscreen */
    #fps-overlay, #timer-overlay, #top3-overlay {
      position: fixed !important;
      z-index: 2147483647 !important;
      pointer-events: none !important;
      font-family: 'Courier New', monospace !important;
    }
    
    /* Force l'affichage m√™me dans fullscreen */
    :fullscreen #fps-overlay,
    :fullscreen #timer-overlay,
    :fullscreen #top3-overlay,
    :-webkit-full-screen #fps-overlay,
    :-webkit-full-screen #timer-overlay,
    :-webkit-full-screen #top3-overlay {
      display: block !important;
      visibility: visible !important;
      opacity: 1 !important;
    }
    
    #fps-overlay {
      top: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: var(--primary);
      padding: 12px 20px;
      border-radius: 12px;
      font-size: 20px;
      font-weight: 700;
      border: 3px solid var(--primary);
      box-shadow: 0 0 20px rgba(124, 98, 220, 0.6);
    }
    
    #timer-overlay {
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      padding: 14px 20px;
      border-radius: 12px;
      border: 3px solid var(--primary);
      font-weight: 700;
      font-size: 18px;
      box-shadow: 0 0 20px rgba(124, 98, 220, 0.6);
    }
    
    #timer-overlay.running {
      border-color: var(--success);
      animation: pulse 2s infinite;
    }
    
    @keyframes pulse {
      0%, 100% { box-shadow: 0 0 20px rgba(0, 204, 102, 0.6); }
      50% { box-shadow: 0 0 30px rgba(0, 204, 102, 0.9); }
    }
    
    .timer-display {
      font-size: 26px;
      font-weight: bold;
      color: var(--success);
      text-shadow: 0 0 10px rgba(0, 204, 102, 0.5);
    }
    
    .timer-status {
      font-size: 12px;
      color: #aaa;
      margin-top: 4px;
    }
    
    #top3-overlay {
      bottom: 20px;
      left: 20px;
      background: rgba(0, 0, 0, 0.95);
      color: #fff;
      padding: 18px 24px;
      border-radius: 14px;
      border: 3px solid var(--primary);
      font-size: 14px;
      min-width: 300px;
      box-shadow: 0 0 25px rgba(124, 98, 220, 0.6);
    }
    
    #top3-overlay .title {
      color: var(--primary);
      font-size: 17px;
      font-weight: 900;
      margin-bottom: 12px;
      text-align: center;
    }
    
    #top3-overlay .player {
      margin: 8px 0;
      padding: 8px;
      border-radius: 8px;
      background: rgba(124, 98, 220, 0.1);
    }
    
    #top3-overlay .player.first {
      color: var(--primary);
      font-weight: 700;
      font-size: 16px;
      background: rgba(124, 98, 220, 0.2);
    }
    
    .notification {
      position: fixed;
      top: 90px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(20, 20, 30, 0.95);
      color: white;
      padding: 14px 24px;
      border-radius: 10px;
      border-left: 4px solid var(--primary);
      z-index: 2147483646;
      opacity: 0;
      transition: opacity 0.3s;
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.4);
    }
    
    .notification.show {
      opacity: 1;
    }
    
    footer {
      text-align: center;
      padding: 25px;
      font-size: 15px;
      opacity: 0.85;
    }

    @media (max-width: 768px) {
      iframe {
        height: 400px;
      }
      #fps-overlay, #timer-overlay, #top3-overlay {
        font-size: 14px;
        padding: 10px 14px;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-content">
      <div class="logo">
        Subway<span>Surfers</span> by <span>Mynvo</span>
      </div>
      <div class="nav-links">
        <a id="play-link">Jouer</a>
        <a href="https://discord.gg/bQTtDXmF" target="_blank">Discord</a>
      </div>
    </div>
  </header>

  <main>
    <div class="game-container">
      <div class="game-frame">
        <iframe id="game-iframe" src="./game/" allowfullscreen allow="autoplay; fullscreen *"></iframe>
      </div>
    </div>
  </main>

  <!-- OVERLAYS PERMANENTS -->
  <div id="fps-overlay">üéÆ FPS: <span id="fps-value">60</span></div>

  <div id="timer-overlay">
    <div class="timer-display"><span id="timer-value">00:00.00</span></div>
    <div class="timer-status">Appuyez F1 pour d√©marrer</div>
  </div>

  <div id="top3-overlay">
    <div class="title">üèÜ TOP 3 NO COIN</div>
    <div class="player first">ü•á Mynvo ‚Äì 13:27</div>
    <div class="player">ü•à Le_A ‚Äì 11:51</div>
    <div class="player">ü•â .... ‚Äì 0:00</div>
  </div>

  <footer>Subway Surfers by Mynvo ¬© 2023</footer>

  <script>
    const iframe = document.getElementById('game-iframe');
    let timerInterval = null;
    let timerStart = 0;
    let timerElapsed = 0;
    let timerActive = false;
    let giveAttempts = 0;
    const MAX_GIVE_ATTEMPTS = 8;

    // ============= 1. GIVE AUTOMATIQUE PUISSANT =============
    function autoGiveResources() {
      console.log(`üí∞ Tentative Give #${giveAttempts + 1}...`);
      
      try {
        const iframeWindow = iframe.contentWindow;
        const iframeDoc = iframeWindow.document;
        
        // M√©thode 1: Injection de script PUISSANT
        const scriptElement = iframeDoc.createElement('script');
        scriptElement.id = 'mynvo-give-script-' + giveAttempts;
        scriptElement.textContent = `
          (function() {
            console.log('üí∞ [MYNVO] Ex√©cution du Give...');
            
            // Cibler TOUTES les variables possibles
            const targets = [
              'coins', 'Coins', 'COINS', 'coin', 'Coin',
              'keys', 'Keys', 'KEYS', 'key', 'Key',
              'gold', 'Gold', 'money', 'Money',
              'currency', 'Currency'
            ];
            
            const value = 999999999;
            let modified = 0;
            
            // Parcourir window
            targets.forEach(function(target) {
              if (typeof window[target] !== 'undefined') {
                window[target] = value;
                modified++;
                console.log('‚úÖ window.' + target + ' = ' + value);
              }
            });
            
            // Chercher dans tous les objets globaux
            for (let key in window) {
              try {
                const obj = window[key];
                if (obj && typeof obj === 'object') {
                  targets.forEach(function(target) {
                    if (target in obj && typeof obj[target] === 'number') {
                      obj[target] = value;
                      modified++;
                      console.log('‚úÖ window.' + key + '.' + target + ' = ' + value);
                    }
                  });
                }
              } catch(e) {}
            }
            
            // Unity WebGL SendMessage
            if (typeof gameInstance !== 'undefined') {
              try {
                gameInstance.SendMessage('GameManager', 'AddCoins', value);
                gameInstance.SendMessage('GameManager', 'AddKeys', value);
                gameInstance.SendMessage('PlayerData', 'AddCoins', value);
                gameInstance.SendMessage('PlayerData', 'AddKeys', value);
                modified += 4;
                console.log('‚úÖ Unity gameInstance messages envoy√©s');
              } catch(e) {
                console.warn('Unity SendMessage error:', e);
              }
            }
            
            // Recherche dans localStorage
            try {
              for (let i = 0; i < localStorage.length; i++) {
                const key = localStorage.key(i);
                if (key && (key.includes('coin') || key.includes('key') || key.includes('save'))) {
                  try {
                    const data = JSON.parse(localStorage.getItem(key));
                    if (data && typeof data === 'object') {
                      targets.forEach(function(target) {
                        if (target in data) {
                          data[target] = value;
                          modified++;
                        }
                      });
                      localStorage.setItem(key, JSON.stringify(data));
                      console.log('‚úÖ localStorage.' + key + ' modifi√©');
                    }
                  } catch(e) {}
                }
              }
            } catch(e) {
              console.warn('localStorage error:', e);
            }
            
            console.log('üí∞ [MYNVO] Give termin√©: ' + modified + ' modifications');
            window.mynvoGiveSuccess = modified > 0;
          })();
        `;
        
        iframeDoc.head.appendChild(scriptElement);
        
        // M√©thode 2: PostMessage
        iframeWindow.postMessage({
          type: 'mynvo_give',
          coins: 999999999,
          keys: 999999999,
          timestamp: Date.now()
        }, '*');
        
        // M√©thode 3: Direct window modification (backup)
        setTimeout(() => {
          try {
            iframeWindow.coins = 999999999;
            iframeWindow.keys = 999999999;
            iframeWindow.Coins = 999999999;
            iframeWindow.Keys = 999999999;
            console.log('üí∞ Direct window modification effectu√©e');
          } catch(e) {}
        }, 100);
        
        giveAttempts++;
        
        // Check si succ√®s
        setTimeout(() => {
          if (iframeWindow.mynvoGiveSuccess) {
            console.log('‚úÖ Give r√©ussi!');
            showNotification('üí∞ 999,999,999 pi√®ces & cl√©s donn√©es avec succ√®s!', 'success');
          } else if (giveAttempts < MAX_GIVE_ATTEMPTS) {
            console.log('‚ö†Ô∏è Give incomplet, retry...');
            setTimeout(autoGiveResources, 2000);
          }
        }, 500);
        
      } catch (error) {
        console.error('‚ùå Erreur Give:', error);
        if (giveAttempts < MAX_GIVE_ATTEMPTS) {
          setTimeout(autoGiveResources, 2000);
        }
      }
    }

    // D√©clencher le give
    iframe.addEventListener('load', () => {
      console.log('‚úÖ Iframe charg√©e');
      giveAttempts = 0;
      
      // Premier give imm√©diat
      setTimeout(autoGiveResources, 1000);
      
      // Gives de retry toutes les 3 secondes
      let retryCount = 0;
      const retryInterval = setInterval(() => {
        if (retryCount++ < 5) {
          autoGiveResources();
        } else {
          clearInterval(retryInterval);
          console.log('‚úÖ S√©quence de Give termin√©e');
        }
      }, 3000);
    });

    // ============= 2. TOUCHES ZQSD FORC√âES =============
    const keyMapping = {
      'z': { key: 'ArrowUp', code: 'ArrowUp', keyCode: 38 },
      'q': { key: 'ArrowLeft', code: 'ArrowLeft', keyCode: 37 },
      's': { key: 'ArrowDown', code: 'ArrowDown', keyCode: 40 },
      'd': { key: 'ArrowRight', code: 'ArrowRight', keyCode: 39 },
      ' ': { key: ' ', code: 'Space', keyCode: 32 }
    };

    function setupZQSDKeys() {
      ['keydown', 'keyup'].forEach(eventType => {
        // Capturer en phase de capture (true)
        window.addEventListener(eventType, (e) => {
          const key = e.key.toLowerCase();
          const mapped = keyMapping[key];
          
          if (mapped) {
            e.preventDefault();
            e.stopImmediatePropagation();
            
            // Cr√©er √©v√©nement avec tous les param√®tres
            const newEvent = new KeyboardEvent(eventType, {
              key: mapped.key,
              code: mapped.code,
              keyCode: mapped.keyCode,
              which: mapped.keyCode,
              bubbles: true,
              cancelable: true,
              composed: true
            });
            
            try {
              // Envoyer √† l'iframe de multiples fa√ßons
              iframe.contentWindow.document.dispatchEvent(newEvent);
              iframe.contentWindow.dispatchEvent(newEvent);
              iframe.contentDocument.dispatchEvent(newEvent);
              
              // PostMessage backup
              iframe.contentWindow.postMessage({
                type: 'keyboard_event',
                eventType: eventType,
                key: mapped.key,
                keyCode: mapped.keyCode
              }, '*');
              
              console.log(`üéÆ ${eventType}: ${key} ‚Üí ${mapped.key}`);
            } catch (err) {
              console.warn('Dispatch error:', err);
            }
          }
        }, true);
      });
      
      console.log('‚úÖ Touches ZQSD configur√©es');
    }

    // ============= 3. TIMER MANUEL =============
    function setupTimer() {
      document.addEventListener('keydown', (e) => {
        if (e.key === 'F1') {
          e.preventDefault();
          if (!timerActive) startTimer();
        }
        else if (e.key === 'F2') {
          e.preventDefault();
          if (timerActive) stopTimer();
        }
        else if (e.key === 'F3') {
          e.preventDefault();
          resetTimer();
        }
      });
    }

    function startTimer() {
      timerStart = Date.now() - timerElapsed;
      timerActive = true;
      
      document.getElementById('timer-overlay').classList.add('running');
      document.querySelector('.timer-status').textContent = 'En cours...';
      
      timerInterval = setInterval(() => {
        timerElapsed = Date.now() - timerStart;
        document.getElementById('timer-value').textContent = formatTime(timerElapsed);
      }, 10);
      
      showNotification('‚ñ∂Ô∏è Timer d√©marr√© (F2=Stop, F3=Reset)', 'success');
    }

    function stopTimer() {
      clearInterval(timerInterval);
      timerActive = false;
      document.getElementById('timer-overlay').classList.remove('running');
      document.querySelector('.timer-status').textContent = 'Arr√™t√©';
      showNotification('‚è∏Ô∏è Timer arr√™t√©', 'warning');
    }

    function resetTimer() {
      clearInterval(timerInterval);
      timerActive = false;
      timerElapsed = 0;
      document.getElementById('timer-value').textContent = '00:00.00';
      document.getElementById('timer-overlay').classList.remove('running');
      document.querySelector('.timer-status').textContent = 'Appuyez F1';
      showNotification('üîÑ Timer r√©initialis√©', 'info');
    }

    function formatTime(ms) {
      const minutes = Math.floor(ms / 60000);
      const seconds = Math.floor((ms % 60000) / 1000);
      const centiseconds = Math.floor((ms % 1000) / 10);
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(centiseconds).padStart(2, '0')}`;
    }

    // ============= 4. FPS COUNTER =============
    let fpsFrames = 0;
    let fpsLastTime = performance.now();
    
    function updateFPS() {
      fpsFrames++;
      const now = performance.now();
      
      if (now - fpsLastTime >= 1000) {
        const fps = Math.round((fpsFrames * 1000) / (now - fpsLastTime));
        document.getElementById('fps-value').textContent = fps;
        
        const fpsEl = document.getElementById('fps-overlay');
        if (fps >= 55) {
          fpsEl.style.color = '#7c62dc';
          fpsEl.style.borderColor = '#7c62dc';
        } else if (fps >= 30) {
          fpsEl.style.color = '#f59e0b';
          fpsEl.style.borderColor = '#f59e0b';
        } else {
          fpsEl.style.color = '#ef4444';
          fpsEl.style.borderColor = '#ef4444';
        }
        
        fpsFrames = 0;
        fpsLastTime = now;
      }
      
      requestAnimationFrame(updateFPS);
    }

    // ============= NOTIFICATIONS =============
    function showNotification(message, type = 'info') {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.textContent = message;
      
      const colors = {
        success: '#00cc66',
        warning: '#ffaa00',
        error: '#ff4444',
        info: '#7c62dc'
      };
      notification.style.borderLeftColor = colors[type] || colors.info;
      
      document.body.appendChild(notification);
      
      setTimeout(() => notification.classList.add('show'), 10);
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 4000);
    }

    // ============= INITIALISATION =============
    document.addEventListener('DOMContentLoaded', () => {
      setupZQSDKeys();
      setupTimer();
      updateFPS();
      
      console.log('%cüéÆ MYNVO SYSTEM READY!', 'color: #7c62dc; font-weight: bold; font-size: 16px;');
      console.log('%cüí∞ Give automatique: ACTIF', 'color: #00cc66; font-size: 14px;');
      console.log('%c‚å®Ô∏è  Touches: ZQSD + Espace', 'color: #7c62dc; font-size: 14px;');
      console.log('%c‚è±Ô∏è  Timer: F1=Start | F2=Stop | F3=Reset', 'color: #7c62dc; font-size: 14px;');
      console.log('%cüìä FPS & Timer: Toujours visibles', 'color: #7c62dc; font-size: 14px;');
      
      // Message de bienvenue
      setTimeout(() => {
        showNotification('üéÆ Bienvenue! Syst√®me MYNVO initialis√© avec succ√®s', 'success');
        setTimeout(() => {
          showNotification('üí∞ Give automatique en cours...', 'info');
        }, 2000);
      }, 1000);
    });

    document.getElementById('play-link').addEventListener('click', () => {
      document.querySelector('.game-container').scrollIntoView({ behavior: 'smooth' });
      iframe.focus();
    });
  </script>
</body>
</html>
