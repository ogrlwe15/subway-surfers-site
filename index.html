<!DOCTYPE html> 
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Subway Surfers by Mynvo</title>
  <meta name="description" content="Subway Surfers version Mynvo avec TOP 3 et FPS">
  <style>
    *{margin:0;padding:0;box-sizing:border-box;}
    body{font-family:'Segoe UI',sans-serif;background:linear-gradient(135deg,#0a0a0a 0%,#1a0a2e 100%);color:#fff;min-height:100vh;display:flex;flex-direction:column;overflow:hidden;}
    
    /* HEADER */
    header{background:rgba(124,98,220,0.12);backdrop-filter:blur(16px);padding:20px 40px;position:fixed;top:0;left:0;right:0;z-index:100;border-bottom:3px solid rgba(124,98,220,0.4);box-shadow:0 4px 30px rgba(124,98,220,0.2);}
    .header-content{max-width:1400px;margin:0 auto;display:flex;justify-content:space-between;align-items:center;}
    .logo{font-size:32px;font-weight:900;display:flex;align-items:center;gap:12px;text-shadow:0 0 20px rgba(124,98,220,0.6);}
    .logo img{height:48px;border-radius:50%;border:3px solid #7c62dc;box-shadow:0 0 25px rgba(124,98,220,0.5);transition:transform 0.3s;}
    .logo img:hover{transform:scale(1.1) rotate(5deg);}
    .logo span{color:#7c62dc;}
    .nav-links a{color:#fff;text-decoration:none;margin-left:28px;font-weight:600;font-size:16px;transition:all 0.3s;cursor:pointer;position:relative;}
    .nav-links a:hover{color:#7c62dc;text-shadow:0 0 10px rgba(124,98,220,0.8);}
    .nav-links a::after{content:'';position:absolute;bottom:-4px;left:0;width:0;height:2px;background:#7c62dc;transition:width 0.3s;}
    .nav-links a:hover::after{width:100%;}
    
    /* MAIN */
    main{flex:1;display:flex;align-items:center;justify-content:center;padding:120px 20px 20px;}
    .game-container{width:100%;max-width:1400px;background:rgba(124,98,220,0.08);backdrop-filter:blur(25px);border-radius:30px;padding:45px;box-shadow:0 30px 90px rgba(124,98,220,0.3);overflow:hidden;position:relative;border:3px solid rgba(124,98,220,0.3);transition:transform 0.3s;}
    .game-container:hover{transform:translateY(-5px);box-shadow:0 35px 100px rgba(124,98,220,0.4);}
    
    h1{font-size:52px;text-align:center;margin-bottom:35px;text-shadow:0 0 40px rgba(124,98,220,0.8);color:#7c62dc;font-weight:900;letter-spacing:2px;}
    
    .game-frame{position:relative;border-radius:24px;overflow:hidden;box-shadow:0 20px 60px rgba(124,98,220,0.4);border:3px solid rgba(124,98,220,0.4);}
    iframe{width:100%;height:720px;border:none;background:#000;display:block;}
    
    .loading{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);z-index:10;text-align:center;}
    .spinner{width:80px;height:80px;border:10px solid rgba(124,98,220,0.2);border-top:10px solid #7c62dc;border-radius:50%;animation:spin 0.8s linear infinite;margin:0 auto 25px;}
    @keyframes spin{to{transform:rotate(360deg);}}
    
    .fs-button{position:absolute;top:20px;right:20px;z-index:200;background:rgba(0,0,0,0.85);border:2px solid #7c62dc;color:#fff;padding:12px 18px;border-radius:14px;cursor:pointer;font-weight:700;font-size:14px;transition:all 0.3s;box-shadow:0 4px 15px rgba(0,0,0,0.5);}
    .fs-button:hover{background:#7c62dc;color:#000;transform:scale(1.05);box-shadow:0 6px 20px rgba(124,98,220,0.6);}
    
    /* OVERLAYS */
    #fps-overlay{position:fixed;top:110px;left:25px;z-index:999999;background:rgba(0,0,0,0.95);color:#7c62dc;padding:14px 22px;border-radius:16px;font-size:20px;font-weight:900;border:3px solid #7c62dc;box-shadow:0 0 30px rgba(124,98,220,0.5);font-family:system-ui,sans-serif;pointer-events:none;transition:all 0.3s;}
    
    #top3-overlay{position:fixed;bottom:25px;left:25px;z-index:999999;background:rgba(0,0,0,0.98);color:#fff;padding:20px 28px;border-radius:18px;border:3px solid #7c62dc;font-size:15px;line-height:1.8;box-shadow:0 0 40px rgba(124,98,220,0.6);font-family:system-ui,sans-serif;pointer-events:none;min-width:300px;}
    #top3-overlay .title{color:#7c62dc;font-size:18px;font-weight:900;margin-bottom:14px;text-align:center;text-shadow:0 0 10px rgba(124,98,220,0.8);}
    #top3-overlay .player{margin:8px 0;padding:10px;border-radius:10px;background:rgba(124,98,220,0.1);transition:all 0.3s;}
    #top3-overlay .player:hover{background:rgba(124,98,220,0.2);transform:translateX(5px);}
    #top3-overlay .player.first{color:#7c62dc;font-weight:800;font-size:16px;}
    
    #timer-overlay{position:fixed;top:25px;right:25px;background:rgba(0,0,0,0.95);color:#fff;padding:14px 20px;border-radius:14px;border:3px solid #7c62dc;z-index:999999;font-weight:900;display:none;font-size:18px;box-shadow:0 0 30px rgba(124,98,220,0.5);}
    
    /* BOTTOM MENU */
    #bottom-menu{position:fixed;bottom:25px;right:25px;background:rgba(0,0,0,0.92);border:3px solid #7c62dc;border-radius:18px;padding:18px 24px;z-index:999999;color:#fff;font-family:'Segoe UI',sans-serif;min-width:280px;box-shadow:0 0 35px rgba(124,98,220,0.6);backdrop-filter:blur(10px);}
    .menu-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:14px;}
    .menu-title{font-size:18px;font-weight:800;color:#7c62dc;text-shadow:0 0 10px rgba(124,98,220,0.6);}
    #close-bottom-menu{background:#7c62dc;border:none;color:#000;font-weight:800;border-radius:10px;padding:6px 12px;cursor:pointer;transition:all 0.3s;}
    #close-bottom-menu:hover{background:#9580e8;transform:scale(1.1);}
    
    .quick-btn{width:100%;padding:12px 14px;background:rgba(124,98,220,0.1);border:2px solid #7c62dc;border-radius:12px;color:#fff;cursor:pointer;font-weight:700;transition:all 0.3s;margin-top:10px;font-size:14px;}
    .quick-btn:hover{background:#7c62dc;color:#000;transform:translateX(5px);box-shadow:0 4px 15px rgba(124,98,220,0.4);}
    
    /* MODALS */
    .mynvo-modal{position:fixed;top:50%;left:50%;transform:translate(-50%,-50%);background:linear-gradient(135deg,#0a0a0a 0%,#1a0a2e 100%);color:#fff;padding:30px;border-radius:20px;border:4px solid #7c62dc;z-index:100000;max-width:94%;width:750px;box-shadow:0 0 80px rgba(124,98,220,0.7);max-height:90vh;overflow-y:auto;}
    .mynvo-modal h2,.mynvo-modal h3{color:#7c62dc;text-align:center;margin-bottom:18px;font-weight:900;text-shadow:0 0 15px rgba(124,98,220,0.8);}
    
    .mynvo-row{display:flex;gap:14px;align-items:center;margin-bottom:14px;}
    .mynvo-label{min-width:130px;color:#aaa;font-weight:600;}
    
    input[type="text"],input[type="range"]{padding:10px;border-radius:10px;border:2px solid #7c62dc;background:rgba(0,0,0,0.6);color:#fff;font-size:15px;}
    input[type="text"]{width:100%;}
    input[type="range"]{flex:1;cursor:pointer;}
    
    .key-display{display:inline-block;min-width:70px;padding:12px 18px;background:#0a0a0a;border:2px solid #7c62dc;border-radius:10px;text-align:center;font-weight:800;font-size:18px;cursor:pointer;transition:all 0.3s;}
    .key-display:hover{border-color:#9580e8;background:rgba(124,98,220,0.2);transform:scale(1.05);}
    .key-display.active{border-color:#00ff00;background:rgba(0,255,0,0.2);animation:pulse 0.6s infinite;}
    @keyframes pulse{0%,100%{transform:scale(1);}50%{transform:scale(1.08);}}
    
    .modal-section{background:rgba(124,98,220,0.08);padding:18px;border-radius:14px;margin-bottom:16px;border:2px solid rgba(124,98,220,0.3);}
    
    button{transition:all 0.3s;font-family:inherit;}
    .btn-primary{background:#7c62dc;color:#000;padding:12px 24px;border:none;border-radius:12px;font-size:16px;cursor:pointer;font-weight:800;}
    .btn-primary:hover{background:#9580e8;transform:scale(1.05);box-shadow:0 6px 20px rgba(124,98,220,0.6);}
    .btn-danger{background:#ef4444;color:#fff;padding:12px 24px;border:none;border-radius:12px;font-size:16px;cursor:pointer;font-weight:800;}
    .btn-danger:hover{background:#dc2626;transform:scale(1.05);}
    
    footer{text-align:center;padding:30px;font-size:15px;background:rgba(124,98,220,0.08);color:#7c62dc;font-weight:600;border-top:2px solid rgba(124,98,220,0.3);}
    
    /* SCROLLBAR */
    ::-webkit-scrollbar{width:12px;}
    ::-webkit-scrollbar-track{background:rgba(0,0,0,0.3);}
    ::-webkit-scrollbar-thumb{background:#7c62dc;border-radius:6px;}
    ::-webkit-scrollbar-thumb:hover{background:#9580e8;}
  </style>
</head>
<body>

  <header>
    <div class="header-content">
      <div class="logo">
        <img src="logo.png" alt="Mynvo" onerror="this.style.display='none'">
        Subway<span>Surfers</span> by <span>Mynvo</span>
      </div>
      <div class="nav-links">
        <a id="play-link">üéÆ Jouer</a>
        <a onclick="openSettings()">‚öôÔ∏è Param√®tres</a>
        <a href="https://discord.gg/bQTtDXmF" target="_blank">üí¨ Discord</a>
      </div>
    </div>
  </header>

  <main>
    <div class="game-container">
      <h1>‚ö° SUBWAY SURFERS ‚ö°</h1>
      <div class="game-frame">
        <div class="loading" id="loading-ui">
          <div class="spinner"></div>
          <p style="font-size:18px;font-weight:700;">Chargement du jeu...</p>
        </div>
        <button class="fs-button" id="fs-btn" title="Plein √©cran">‚§¢ Plein √©cran</button>
        <iframe id="game-iframe" src="./game/" allowfullscreen allow="autoplay; fullscreen *"></iframe>
      </div>
    </div>
  </main>

  <div id="fps-overlay">üéÆ FPS: <span id="fps-value">60</span></div>
  
  <div id="top3-overlay">
    <div class="title">üèÜ TOP 3 NO COIN</div>
    <div class="player first">ü•á Mynvo ‚Äì 13:27</div>
    <div class="player">ü•à Le_A ‚Äì 11:51</div>
    <div class="player">ü•â .... ‚Äì 0:00</div>
  </div>

  <div id="timer-overlay">‚è±Ô∏è <span id="timer-value">00:00</span></div>

  <div id="bottom-menu">
    <div class="menu-header">
      <div class="menu-title">‚öôÔ∏è Menu Rapide</div>
      <button id="close-bottom-menu">‚úñ</button>
    </div>
    <button class="quick-btn" onclick="openSettings()">üéÆ Param√®tres & Touches</button>
    <button class="quick-btn" onclick="toggleFPS()">üìä Afficher/Masquer FPS</button>
    <button class="quick-btn" onclick="toggleFullscreen()">‚§¢ Mode Plein √âcran</button>
    <button class="quick-btn" onclick="openVolumeMenu()">üîä Volume du Jeu</button>
    <button class="quick-btn" onclick="openMapMenu()">üó∫Ô∏è Position TOP3</button>
    <button class="quick-btn" onclick="openTimerMenu()">‚è±Ô∏è Timer & Chrono</button>
  </div>

  <footer>üéÆ Subway Surfers by Mynvo | Meilleure exp√©rience de jeu üöÄ</footer>

  <script src="script.js"></script>
</body>
</html>

// ============================================
// SUBWAY SURFERS MYNVO - SCRIPT OPTIMIS√â
// Partie 1: Configuration & Utilitaires
// ============================================

// Configuration globale
let config = {
  up: "z",
  down: "s", 
  left: "q",
  right: "d",
  jump: " ",
  name: "Joueur",
  showFPS: true,
  showTop3: true,
  top3Position: "bottom-left",
  volume: 1,
  timerKey: null,
  timerRunning: false
};

// Variables globales
let isCapturingKey = false;
let iframeReady = false;
let keyStates = {};
let currentCanvas = null;
let fpsFrames = 0;
let fpsLastTime = performance.now();
let timerInterval = null;
let timerStart = 0;

const iframe = document.getElementById('game-iframe');

// ============================================
// UTILITAIRES
// ============================================

function escapeHtml(str) {
  if (!str && str !== '') return '';
  return String(str).replace(/[&<>"']/g, m => ({
    '&': '&amp;',
    '<': '&lt;',
    '>': '&gt;',
    '"': '&quot;',
    "'": '&#39;'
  })[m]);
}

function getKeyDisplay(key) {
  if (key === ' ') return 'ESPACE';
  if (!key) return '...';
  return key.toString().toUpperCase();
}

function getKeyCode(key) {
  const keyMap = {
    'ArrowUp': 38, 'ArrowDown': 40, 'ArrowLeft': 37, 'ArrowRight': 39,
    ' ': 32, 'z': 90, 'Z': 90, 'q': 81, 'Q': 81,
    's': 83, 'S': 83, 'd': 68, 'D': 68,
    'w': 87, 'W': 87, 'a': 65, 'A': 65
  };
  return keyMap[key] || 0;
}

function formatTime(ms) {
  const total = Math.max(0, Math.floor(ms / 1000));
  const mm = String(Math.floor(total / 60)).padStart(2, '0');
  const ss = String(total % 60).padStart(2, '0');
  return `${mm}:${ss}`;
}

// ============================================
// GESTION CONFIG (LocalStorage)
// ============================================

function loadConfig() {
  try {
    const saved = localStorage.getItem("mynvoConfig");
    if (saved) {
      config = { ...config, ...JSON.parse(saved) };
      console.log('%c[MYNVO] ‚úÖ Configuration charg√©e', 'color: #7c62dc; font-weight: bold;', config);
    }
  } catch (e) {
    console.warn('[MYNVO] ‚ö†Ô∏è Erreur chargement config:', e);
  }
}

function saveConfig() {
  try {
    localStorage.setItem("mynvoConfig", JSON.stringify(config));
    console.log('%c[MYNVO] üíæ Configuration sauvegard√©e', 'color: #7c62dc; font-weight: bold;', config);
  } catch (e) {
    console.error('[MYNVO] ‚ùå Erreur sauvegarde config:', e);
  }
}

function applyOverlaysFromConfig() {
  document.getElementById('fps-overlay').style.display = config.showFPS ? 'block' : 'none';
  document.getElementById('top3-overlay').style.display = config.showTop3 ? 'block' : 'none';
  positionTop3(config.top3Position);
  document.getElementById('fps-value').textContent = '60';
  document.getElementById('timer-overlay').style.display = config.timerRunning ? 'block' : 'none';
}

function positionTop3(pos) {
  const el = document.getElementById('top3-overlay');
  el.style.top = el.style.bottom = el.style.left = el.style.right = '';
  
  switch(pos) {
    case 'bottom-left':
      el.style.bottom = '25px';
      el.style.left = '25px';
      break;
    case 'bottom-right':
      el.style.bottom = '25px';
      el.style.right = '25px';
      break;
    case 'top-left':
      el.style.top = '110px';
      el.style.left = '25px';
      break;
    case 'top-right':
      el.style.top = '110px';
      el.style.right = '25px';
      break;
  }
}

// ============================================
// COMMUNICATION IFRAME
// ============================================

function postToIframe(msg) {
  try {
    iframe.contentWindow.postMessage(msg, '*');
  } catch (e) {
    console.warn('[MYNVO] ‚ö†Ô∏è postMessage √©chou√©:', e);
  }
}

function simulateKeyInIframe(type, mappedKey, keyCode) {
  if (!keyCode) return;

  try {
    const iframeWin = iframe.contentWindow;
    const iframeDoc = iframe.contentDocument || iframeWin.document;

    if (!iframeDoc) {
      postToIframe({ type: 'keyboard_event', eventType: type, key: mappedKey, keyCode });
      return;
    }

    const event = new KeyboardEvent(type, {
      keyCode: keyCode,
      which: keyCode,
      key: mappedKey,
      bubbles: true,
      cancelable: true
    });

    iframeDoc.dispatchEvent(event);
    iframeWin.dispatchEvent(event);
    
    if (currentCanvas) {
      currentCanvas.dispatchEvent(event);
    }
    
    iframeDoc.querySelectorAll('canvas, #canvas, #unity-canvas').forEach(el => {
      el.dispatchEvent(event);
    });

    console.log(`%c[MYNVO] üéØ ${type}: ${mappedKey} (${keyCode})`, 'color: #7c62dc;');
  } catch (err) {
    console.error('[MYNVO] ‚ùå Erreur dispatch event:', err);
  }
}

// Charger la config au d√©marrage
loadConfig();

console.log('%c[MYNVO] üöÄ Syst√®me initialis√©!', 'color: #7c62dc; font-weight: bold; font-size: 16px;');


      // ============================================
// SUBWAY SURFERS MYNVO - SCRIPT OPTIMIS√â
// Partie 4: Timer & Chronom√®tre
// ============================================

// ============================================
// MENU TIMER
// ============================================

function openTimerMenu() {
  if (document.getElementById('mynvo-timer')) return;

  const modal = document.createElement('div');
  modal.id = 'mynvo-timer';
  modal.className = 'mynvo-modal';
  
  modal.innerHTML = `
    <h3>‚è±Ô∏è Chronom√®tre</h3>
    
    <div class="modal-section">
      <h4 style="color:#aaa;margin-bottom:12px;font-size:16px;">Configuration</h4>
      <div class="mynvo-row">
        <div class="mynvo-label">Touche Raccourci</div>
        <input id="timer-key-input" readonly 
               style="flex:1;padding:10px;background:rgba(0,0,0,0.6);border:2px solid #7c62dc;border-radius:10px;color:#fff;text-align:center;font-weight:700;" 
               value="${config.timerKey ? getKeyDisplay(config.timerKey) : 'Non assign√©e'}">
        <button id="set-timer-key" class="btn-primary" style="padding:10px 16px;">D√©finir</button>
      </div>
      <div style="font-size:13px;color:#aaa;margin-top:10px;">
        üí° Cette touche permet de d√©marrer/arr√™ter le timer rapidement pendant le jeu
      </div>
    </div>

    <div class="modal-section">
      <h4 style="color:#aaa;margin-bottom:12px;font-size:16px;">Contr√¥les</h4>
      <div style="display:flex;gap:10px;justify-content:center;">
        <button id="start-timer" class="btn-primary" style="flex:1;padding:14px;">
          ‚ñ∂Ô∏è D√©marrer
        </button>
        <button id="stop-timer" class="btn-danger" style="flex:1;padding:14px;">
          ‚è∏Ô∏è Arr√™ter
        </button>
        <button id="reset-timer" style="flex:1;padding:14px;background:rgba(124,98,220,0.2);border:2px solid #7c62dc;border-radius:12px;color:#fff;font-weight:700;cursor:pointer;">
          üîÑ Reset
        </button>
      </div>
    </div>

    <div style="text-align:center;margin-top:20px;">
      <button id="close-timer" class="btn-danger">Fermer</button>
    </div>
  `;

  document.body.appendChild(modal);

  // D√©finir la touche timer
  modal.querySelector('#set-timer-key').addEventListener('click', () => {
    const input = modal.querySelector('#timer-key-input');
    input.value = '... Appuie sur une touche';
    isCapturingKey = true;

    const handler = (e) => {
      e.preventDefault();
      e.stopPropagation();
      config.timerKey = e.key;
      input.value = getKeyDisplay(e.key);
      isCapturingKey = false;
      saveConfig();
      document.removeEventListener('keydown', handler, true);
      console.log(`[MYNVO] ‚è±Ô∏è Touche timer: ${e.key}`);
    };

    document.addEventListener('keydown', handler, true);
  });

  // Boutons de contr√¥le
  modal.querySelector('#start-timer').addEventListener('click', startTimer);
  modal.querySelector('#stop-timer').addEventListener('click', stopTimer);
  modal.querySelector('#reset-timer').addEventListener('click', resetTimer);
  modal.querySelector('#close-timer').addEventListener('click', () => modal.remove());
}

// ============================================
// FONCTIONS TIMER
// ============================================

function startTimer() {
  if (timerInterval) {
    console.log('[MYNVO] ‚è±Ô∏è Timer d√©j√† en cours');
    return;
  }

  timerStart = Date.now();
  document.getElementById('timer-overlay').style.display = 'block';
  
  timerInterval = setInterval(() => {
    const elapsed = Date.now() - timerStart;
    document.getElementById('timer-value').textContent = formatTime(elapsed);
    
    // Envoyer √† l'iframe (optionnel)
    postToIframe({ type: 'timer_update', elapsed: elapsed });
  }, 250);

  config.timerRunning = true;
  saveConfig();
  
  console.log('%c[MYNVO] ‚ñ∂Ô∏è Timer d√©marr√©!', 'color: #7c62dc; font-weight: bold;');
}

function stopTimer() {
  if (!timerInterval) {
    console.log('[MYNVO] ‚è±Ô∏è Timer d√©j√† arr√™t√©');
    return;
  }

  clearInterval(timerInterval);
  timerInterval = null;
  
  config.timerRunning = false;
  saveConfig();
  
  const finalTime = document.getElementById('timer-value').textContent;
  console.log(`%c[MYNVO] ‚è∏Ô∏è Timer arr√™t√©: ${finalTime}`, 'color: #7c62dc; font-weight: bold;');
}

function resetTimer() {
  timerStart = Date.now();
  document.getElementById('timer-value').textContent = '00:00';
  
  postToIframe({ type: 'timer_reset' });
  
  console.log('%c[MYNVO] üîÑ Timer r√©initialis√©', 'color: #7c62dc; font-weight: bold;');
}

function toggleTimer() {
  if (timerInterval) {
    stopTimer();
    document.getElementById('timer-overlay').style.display = 'none';
  } else {
    startTimer();
  }
}

// ============================================
// INITIALISATION FINALE
// ============================================

// Si le timer √©tait en cours, le red√©marrer
if (config.timerRunning) {
  console.log('[MYNVO] ‚è±Ô∏è Restauration du timer...');
  // Note: on ne red√©marre pas automatiquement pour √©viter la confusion
  // L'utilisateur doit le relancer manuellement
  config.timerRunning = false;
  saveConfig();
}

console.log('%c[MYNVO] ‚è±Ô∏è Syst√®me de timer charg√©!', 'color: #7c62dc; font-weight: bold;');
console.log('%c[MYNVO] üéâ Tous les syst√®mes sont op√©rationnels!', 'color: #7c62dc; font-weight: bold; font-size: 18px;');
console.log('%c[MYNVO] Configuration actuelle:', 'color: #7c62dc;', config);
