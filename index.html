<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Subway Surfers by Mynvo - Jeu en ligne gratuit</title>
  <meta name="description" content="Jouez √† Subway Surfers version Mynvo avec TOP 3 et FPS. Jeu gratuit en ligne avec personnalisation des touches et param√®tres avanc√©s.">
  <meta name="keywords" content="subway surfers, jeu en ligne, mynvo, jeu gratuit, subway surfers mod">
  <style>
    :root {
      --primary: #7c62dc;
      --primary-dark: #6a50c9;
      --primary-light: #9580e8;
      --primary-transparent: rgba(124, 98, 220, 0.15);
      --bg-dark: #0a0a0a;
      --bg-card: rgba(30, 30, 40, 0.8);
      --text-light: #f0f0f0;
      --text-muted: #aaa;
      --success: #00cc66;
      --danger: #ff4444;
      --warning: #ffaa00;
      --primary-bg: #0f172a;
      --header-bg: #1e293b;
      --card-bg: rgba(30, 41, 59, 0.7);
      --card-hover-bg: rgba(51, 65, 85, 0.8);
      --border-color: #475569;
      --border-hover-color: #64748b;
      --text-primary: #f8fafc;
      --text-secondary: #cbd5e1;
      --text-accent: #000000;
      --button-primary: linear-gradient(135deg, #000000, #1a1a1a);
      --glow-primary: 0 0 20px rgba(0, 0, 0, 0.5);
      --timer-bg: rgba(15, 23, 42, 0.9);
      --timer-text: #f8fafc;
      --timer-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
      --timer-border: 2px solid #000000;
      --timer-glow: #000000;
      --border-radius: 12px;
      --transition: all 0.3s ease;
    }
   
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Inter', sans-serif;
    }
   
    body {
      font-family: 'Segoe UI', system-ui, sans-serif;
      background: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 100%);
      color: var(--text-light);
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      overflow-x: hidden;
      width: 400px;
      min-height: 200px;
      background: var(--primary-bg);
      color: var(--text-primary);
      padding: 20px;
      line-height: 1.6;
      backdrop-filter: blur(10px);
      -webkit-font-smoothing: antialiased;
    }
   
    /* Header am√©lior√© */
    header {
      background: var(--primary-transparent);
      backdrop-filter: blur(12px);
      padding: 18px 40px;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 1000;
      border-bottom: 2px solid var(--primary);
      box-shadow: 0 5px 20px rgba(0, 0, 0, 0.3);
    }
   
    .header-content {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
   
    .logo {
      font-size: 34px;
      font-weight: 900;
      display: flex;
      align-items: center;
      gap: 14px;
    }
   
    .logo img {
      height: 50px;
      width: 50px;
      border-radius: 50%;
      border: 4px solid var(--primary);
      box-shadow: 0 0 20px var(--primary-transparent);
      object-fit: cover;
    }
   
    .logo span {
      color: var(--primary);
      text-shadow: 0 0 10px rgba(124, 98, 220, 0.5);
    }
   
    .nav-links {
      display: flex;
      align-items: center;
    }
   
    .nav-links a {
      color: #fff;
      text-decoration: none;
      margin-left: 24px;
      font-weight: 600;
      font-size: 17px;
      transition: 0.2s;
      cursor: pointer;
      position: relative;
      padding: 8px 0;
    }
   
    .nav-links a:hover {
      color: var(--primary);
    }
   
    .nav-links a::after {
      content: '';
      position: absolute;
      bottom: 0;
      left: 0;
      width: 0;
      height: 2px;
      background: var(--primary);
      transition: width 0.3s;
    }
   
    .nav-links a:hover::after {
      width: 100%;
    }
   
    /* Main content */
    main {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 120px 20px 40px;
    }
   
    .game-container {
      width: 100%;
      max-width: 1350px;
      background: var(--bg-card);
      backdrop-filter: blur(20px);
      border-radius: 28px;
      padding: 40px;
      box-shadow: 0 25px 80px rgba(124, 98, 220, 0.25);
      overflow: hidden;
      position: relative;
      border: 2px solid var(--primary);
      animation: containerGlow 4s infinite alternate;
    }
   
    @keyframes containerGlow {
      0% {
        box-shadow: 0 25px 80px rgba(124, 98, 220, 0.25);
      }
      100% {
        box-shadow: 0 25px 80px rgba(124, 98, 220, 0.4);
      }
    }
   
    .game-frame {
      position: relative;
      border-radius: 20px;
      overflow: hidden;
      box-shadow: 0 15px 50px rgba(124, 98, 220, 0.3);
      border: 2px solid var(--primary);
    }
   
    iframe {
      width: 100%;
      height: 720px;
      border: none;
      background: #000000;
      display: block;
    }
   
    .loading {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      z-index: 10;
      text-align: center;
      background: rgba(0, 0, 0, 0.8);
      padding: 30px;
      border-radius: 15px;
      border: 2px solid var(--primary);
    }
   
    .spinner {
      width: 70px;
      height: 70px;
      border: 8px solid #ffffff33;
      border-top: 8px solid var(--primary);
      border-radius: 50%;
      animation: spin 1s linear infinite;
      margin-bottom: 20px;
    }
   
    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }
   
    footer {
      text-align: center;
      padding: 25px;
      font-size: 15px;
      opacity: 0.85;
      background: rgba(124, 98, 220, 0.08);
      color: var(--primary);
    }
   
    .fs-button {
      position: absolute;
      top: 18px;
      right: 18px;
      z-index: 200;
      background: rgba(0, 0, 0, 0.8);
      border: 2px solid var(--primary);
      color: #fff;
      padding: 10px 14px;
      border-radius: 12px;
      cursor: pointer;
      font-weight: 700;
      transition: all 0.3s;
    }
   
    .fs-button:hover {
      background: var(--primary);
      color: #000;
      transform: scale(1.05);
    }
   
    /* Overlays qui restent en plein √©cran */
    #fps-overlay {
      position: fixed;
      top: 100px;
      left: 20px;
      z-index: 2147483647;
      background: rgba(0, 0, 0, 0.95);
      color: var(--primary);
      padding: 10px 18px;
      border-radius: 12px;
      font-size: 18px;
      font-weight: 700;
      border: 2px solid var(--primary);
      box-shadow: 0 0 20px rgba(124, 98, 220, 0.4);
      font-family: system-ui, sans-serif;
      pointer-events: none;
      transition: all 0.3s;
    }
   
    #top3-overlay {
      position: fixed;
      bottom: 20px;
      left: 20px;
      z-index: 2147483647;
      background: rgba(0, 0, 0, 0.98);
      color: #fff;
      padding: 16px 22px;
      border-radius: 14px;
      border: 2px solid var(--primary);
      font-size: 14px;
      line-height: 1.6;
      box-shadow: 0 0 30px rgba(124, 98, 220, 0.5);
      font-family: system-ui, sans-serif;
      pointer-events: none;
      min-width: 280px;
      backdrop-filter: blur(10px);
    }
   
    #top3-overlay .title {
      color: var(--primary);
      font-size: 16px;
      font-weight: 900;
      margin-bottom: 10px;
      text-align: center;
    }
   
    #top3-overlay .player {
      margin: 6px 0;
      padding: 6px;
      border-radius: 8px;
      background: rgba(124, 98, 220, 0.08);
      transition: all 0.3s;
    }
   
    #top3-overlay .player.first {
      color: var(--primary);
      font-weight: 700;
      font-size: 15px;
      background: rgba(124, 98, 220, 0.15);
    }
   
    /* Timer overlay - reste en plein √©cran */
    #timer-overlay {
      position: fixed;
      top: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.9);
      color: #fff;
      padding: 12px 16px;
      border-radius: 12px;
      border: 2px solid var(--primary);
      z-index: 2147483647;
      font-weight: 700;
      font-size: 18px;
      display: none;
      box-shadow: 0 0 20px rgba(124, 98, 220, 0.4);
      backdrop-filter: blur(5px);
      pointer-events: none;
    }
   
    #timer-overlay.running {
      border-color: var(--success);
      animation: pulse 2s infinite;
    }
   
    #timer-overlay.stopped {
      border-color: var(--danger);
    }
   
    .timer-display {
      font-family: 'Courier New', monospace;
      font-size: 24px;
      font-weight: bold;
      color: var(--success);
      text-shadow: 0 0 10px rgba(0, 204, 102, 0.5);
    }
   
    .timer-status {
      font-size: 12px;
      color: var(--text-muted);
      margin-top: 4px;
    }
   
    /* Bottom menu - CACH√â PAR D√âFAUT */
    #bottom-menu {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: rgba(0, 0, 0, 0.95);
      border: 2px solid var(--primary);
      border-radius: 14px;
      padding: 14px 18px;
      z-index: 999999;
      color: #fff;
      font-family: 'Segoe UI', sans-serif;
      min-width: 260px;
      box-shadow: 0 0 25px rgba(124, 98, 220, 0.55);
      backdrop-filter: blur(10px);
      transition: all 0.3s;
      display: none;
    }
   
    #bottom-menu.visible {
      display: block;
    }
   
    .quick-btn {
      width: 100%;
      padding: 10px 12px;
      background: #111;
      border: 2px solid var(--primary);
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.15s;
      margin-top: 8px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
   
    .quick-btn:hover {
      background: var(--primary);
      color: #000;
      transform: translateX(5px);
    }
   
    /* Style pour le bouton Give Piece */
    .give-piece-btn {
      background: linear-gradient(135deg, #ffd700, #ffaa00);
      color: #000;
      border: none;
      border-radius: 10px;
      padding: 12px 16px;
      font-weight: 700;
      cursor: pointer;
      transition: all 0.3s;
      box-shadow: 0 0 20px rgba(255, 215, 0, 0.4);
    }
   
    .give-piece-btn:hover {
      transform: scale(1.05);
      box-shadow: 0 0 30px rgba(255, 215, 0, 0.6);
    }
   
    /* Modal am√©lior√© */
    .mynvo-modal {
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: var(--bg-card);
      color: #fff;
      padding: 24px;
      border-radius: 16px;
      border: 4px solid var(--primary);
      z-index: 100000;
      max-width: 92%;
      width: 720px;
      box-shadow: 0 0 60px rgba(124, 98, 220, 0.55);
      backdrop-filter: blur(15px);
      animation: modalAppear 0.3s ease-out;
    }
   
    @keyframes modalAppear {
      0% {
        opacity: 0;
        transform: translate(-50%, -50%) scale(0.9);
      }
      100% {
        opacity: 1;
        transform: translate(-50%, -50%) scale(1);
      }
    }
   
    .mynvo-row {
      display: flex;
      gap: 12px;
      align-items: center;
      margin-bottom: 12px;
    }
   
    .mynvo-label {
      min-width: 120px;
      color: var(--text-muted);
    }
   
    .key-display {
      display: inline-block;
      min-width: 50px;
      padding: 10px 16px;
      background: var(--bg-dark);
      border: 2px solid var(--primary);
      border-radius: 8px;
      text-align: center;
      font-weight: 700;
      font-size: 18px;
      cursor: pointer;
      transition: 0.2s;
    }
   
    .key-display:hover {
      border-color: var(--primary-light);
      background: #1a1a1a;
    }
   
    .key-display.active {
      border-color: var(--success);
      background: #1a4d1a;
      animation: pulse 0.5s;
    }
   
    @keyframes pulse {
      0%, 100% {
        transform: scale(1);
      }
      50% {
        transform: scale(1.05);
      }
    }
   
    /* Nouveau style pour les sections de param√®tres */
    .settings-section {
      background: rgba(20, 20, 30, 0.7);
      padding: 16px;
      border-radius: 12px;
      margin-bottom: 16px;
      border: 1px solid rgba(124, 98, 220, 0.3);
    }
   
    .settings-section h3 {
      color: var(--primary);
      margin-bottom: 12px;
      font-size: 18px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
   
    /* Animation de particules en arri√®re-plan */
    .particles {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: -1;
      overflow: hidden;
    }
   
    .particle {
      position: absolute;
      background: rgba(124, 98, 220, 0.3);
      border-radius: 50%;
      animation: float 15s infinite linear;
    }
   
    @keyframes float {
      0% {
        transform: translateY(0) translateX(0);
        opacity: 0;
      }
      10% {
        opacity: 1;
      }
      90% {
        opacity: 1;
      }
      100% {
        transform: translateY(-100vh) translateX(100px);
        opacity: 0;
      }
    }
   
    /* Style pour les notifications */
    .notification {
      position: fixed;
      top: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: var(--bg-card);
      color: white;
      padding: 12px 20px;
      border-radius: 8px;
      border-left: 4px solid var(--primary);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      z-index: 100001;
      display: flex;
      align-items: center;
      gap: 10px;
      opacity: 0;
      transition: opacity 0.3s;
    }
   
    .notification.show {
      opacity: 1;
    }
   
    /* Am√©liorations responsive */
    @media (max-width: 1200px) {
      .game-container {
        padding: 30px;
      }
     
      iframe {
        height: 600px;
      }
    }
   
    @media (max-width: 768px) {
      header {
        padding: 14px 20px;
      }
     
      .logo {
        font-size: 24px;
      }
     
      .logo img {
        height: 40px;
        width: 40px;
      }
     
      .nav-links a {
        margin-left: 16px;
        font-size: 15px;
      }
     
      .game-container {
        padding: 20px;
      }
     
      iframe {
        height: 400px;
      }
     
      #bottom-menu {
        min-width: 240px;
        right: 10px;
        bottom: 10px;
      }
    }
   
    @media (max-width: 480px) {
      .header-content {
        flex-direction: column;
        gap: 10px;
      }
     
      .nav-links {
        width: 100%;
        justify-content: center;
      }
     
      .nav-links a {
        margin: 0 10px;
      }
     
      iframe {
        height: 300px;
      }
    }

    .container {
      max-width: 100%;
      margin: 0 auto;
    }

    .header {
      background: var(--header-bg);
      padding: 16px;
      border-radius: var(--border-radius);
      margin-bottom: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .title {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      text-align: center;
    }

    .card {
      background: var(--card-bg);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 16px;
      margin: 12px 0;
      backdrop-filter: blur(8px);
      transition: var(--transition);
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
    }

    .card:hover {
      border-color: var(--border-hover-color);
      transform: translateY(-2px);
      box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
    }

    button {
      padding: 10px 20px;
      margin: 6px;
      background: var(--button-primary);
      color: white;
      border: none;
      border-radius: var(--border-radius);
      cursor: pointer;
      font-weight: 500;
      transition: var(--transition);
      box-shadow: var(--glow-primary);
      text-transform: capitalize;
    }

    button:hover {
      transform: translateY(-2px);
      box-shadow: var(--glow-primary), 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    button:active {
      transform: translateY(0);
    }

    .tab-container {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      overflow-x: auto;
      padding-bottom: 8px;
    }

    .tab-btn {
      background: var(--card-bg);
      color: var(--text-secondary);
      padding: 8px 16px;
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      cursor: pointer;
      transition: var(--transition);
      white-space: nowrap;
    }

    .tab-btn.active {
      background: var(--button-primary);
      color: white;
      border-color: transparent;
    }

    .tab-content {
      display: none;
      opacity: 0;
      transition: var(--transition);
    }

    .tab-content.active {
      display: block;
      opacity: 1;
    }

    /* Header / Logo container (used in popup.html) */
    .logo-container, .header-title, .header-version {
      display: inline-flex;
      align-items: center;
    }

    .logo-container {
      gap: 10px;
    }

    .logo {
      width: 36px;
      height: 36px;
      border-radius: 8px;
      object-fit: cover;
    }

    .header-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--text-primary);
    }

    .header-version {
      font-size: 12px;
      color: var(--text-secondary);
      margin-left: 8px;
    }

    /* Tabs row used in popup.html (.tabs .tab-btn) */
    .tabs {
      display: flex;
      gap: 8px;
      margin-bottom: 12px;
      align-items: center;
    }

    .tab-btn {
      background: transparent;
      border: none;
      padding: 8px 12px;
      cursor: pointer;
      font-size: 13px;
      font-weight: 600;
      color: var(--text-secondary);
      border-bottom: 3px solid transparent;
      transition: color 0.18s, border-bottom-color 0.18s, transform 0.12s;
      user-select: none;
    }

    .tab-btn.active {
      color: var(--text-accent);
      border-bottom-color: var(--text-accent);
    }

    /* City links */
    .city-list {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .city-link {
      display: block;
      padding: 10px 14px;
      background: var(--card-bg);
      color: var(--text-primary);
      border-radius: 10px;
      text-decoration: none;
      border: 1px solid var(--border-color);
      transition: transform 0.12s ease, background 0.12s;
    }

    .city-link:hover {
      transform: translateY(-2px);
      background: var(--card-hover-bg);
    }

    /* Theme grid adjustments */
    .theme-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(110px, 1fr));
      gap: 10px;
      margin-top: 10px;
    }

    .theme-card {
      border-radius: 10px;
      overflow: hidden;
      cursor: pointer;
      transition: transform 0.12s ease, box-shadow 0.18s ease;
    }

    .theme-card .theme-preview {
      height: 44px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 13px;
      font-weight: 800;
    }

    .theme-card .theme-name {
      padding: 8px 6px 12px;
    }

    .theme-card.active {
      box-shadow: 0 6px 20px rgba(0,0,0,0.28);
      transform: translateY(-4px);
    }

    /* Status toast */
    .status {
      position: fixed;
      left: 50%;
      transform: translateX(-50%);
      bottom: 70px;
      padding: 10px 16px;
      border-radius: 999px;
      font-weight: 700;
      color: var(--primary-bg);
      display: none;
      opacity: 0;
      transition: opacity 0.28s ease, transform 0.18s ease;
      z-index: 9999;
    }

    .status.success { background: linear-gradient(90deg,#34d399,#10b981); }
    .status.error { background: linear-gradient(90deg,#fb7185,#ef4444); }

    .footer {
      text-align: center;
      padding: 10px 0;
      font-size: 12px;
      color: var(--text-secondary);
      margin-top: 14px;
    }

    /* Layout: sidebar + content */
    .main-layout {
      display: grid;
      grid-template-columns: 120px 1fr;
      gap: 14px;
      align-items: start;
    }

    .sidebar {
      padding: 12px;
      height: auto;
    }

    .content {
      padding: 6px 0;
    }

    .muted { color: var(--text-secondary); font-size: 13px; }

    .actions { display: flex; gap: 10px; flex-wrap: wrap; }

    /* Button variants */
    .action-button.success { background: linear-gradient(90deg,#34d399,#10b981); color: #022; }
    .action-button.danger { background: linear-gradient(90deg,#fb7185,#ef4444); color: #fff; }
    .action-button.accent { background: linear-gradient(90deg,#00d4ff,#ff6ec7); color: #0a0a0a; }

    .resolution-buttons { display: flex; gap: 8px; margin-top: 10px; }

    .small { font-size: 11px; opacity: 0.85; }

    /* Ensure existing selectors used by JS still match */
    .tab-content-container { min-height: 220px; }

    @media (max-width: 420px) {
      .main-layout { grid-template-columns: 1fr; }
      .sidebar { order: 2; }
    }

    input[type="text"],
    input[type="number"],
    select {
      width: 100%;
      padding: 10px;
      margin: 8px 0;
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      background: var(--card-bg);
      color: var(--text-primary);
      transition: var(--transition);
    }

    input[type="text"]:focus,
    input[type="number"]:focus,
    select:focus {
      border-color: var(--text-accent);
      outline: none;
      box-shadow: 0 0 0 2px rgba(96, 165, 250, 0.2);
    }

    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: var(--card-bg);
      transition: var(--transition);
      border-radius: 34px;
      border: 1px solid var(--border-color);
    }

    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 3px;
      background-color: var(--text-primary);
      transition: var(--transition);
      border-radius: 50%;
    }

    input:checked + .slider {
      background: var(--button-primary);
    }

    input:checked + .slider:before {
      transform: translateX(26px);
    }

    .timer-display {
      font-size: 48px;
      font-weight: 700;
      text-align: center;
      padding: 20px;
      background: var(--timer-bg);
      border-radius: var(--border-radius);
      border: var(--timer-border);
      box-shadow: var(--timer-shadow);
      color: var(--timer-text);
      margin: 20px 0;
      transition: var(--transition);
    }

    .timer-controls {
      display: flex;
      justify-content: center;
      gap: 10px;
      flex-wrap: wrap;
    }

    .settings-group {
      margin: 16px 0;
    }

    .settings-group label {
      display: block;
      margin-bottom: 8px;
      color: var(--text-secondary);
      font-weight: 500;
    }

    .icon-button {
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }

    .icon-button svg {
      width: 20px;
      height: 20px;
    }

    /* Ripple Effect */
    .ripple {
      position: absolute;
      background: rgba(255, 255, 255, 0.3);
      border-radius: 50%;
      transform: scale(0);
      animation: ripple 0.6s linear;
      pointer-events: none;
    }

    @keyframes ripple {
      to {
        transform: scale(4);
        opacity: 0;
      }
    }

    /* Scrollbar Styling */
    ::-webkit-scrollbar {
      width: 8px;
      height: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--primary-bg);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border-color);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--border-hover-color);
    }
  </style>
</head>
<body>
  <!-- Particules d'arri√®re-plan -->
  <div class="particles" id="particles-container"></div>
  <header>
    <div class="header-content">
      <div class="logo">
        <img src="logo.png" alt="Mynvo" onerror="this.style.display='none'">
        Subway<span>Surfers</span> by <span>Mynvo</span>
      </div>
      <div class="nav-links">
        <a id="play-link">Jouer</a>
        <a onclick="toggleBottomMenu();return false;">Param√®tres</a>
        <a href="https://discord.gg/bQTtDXmF" target="_blank">Discord</a>
      </div>
    </div>
  </header>
  <main>
    <div class="game-container">
      <div class="game-frame">
        <div class="loading" id="loading-ui"><div class="spinner"></div><p>Chargement du jeu...</p></div>
        <button class="fs-button" id="fs-btn" title="Plein √©cran">‚§¢ Plein √©cran</button>
        <iframe id="game-iframe" src="./game/" allowfullscreen allow="autoplay; fullscreen *"></iframe>
      </div>
    </div>
  </main>
  <!-- FPS Counter - RESTE EN PLEIN √âCRAN -->
  <div id="fps-overlay">üéÆ FPS: <span id="fps-value">60</span></div>
  <!-- TOP 3 - RESTE EN PLEIN √âCRAN -->
  <div id="top3-overlay">
    <div class="title">üèÜ TOP 3 NO COIN</div>
    <div class="player first">ü•á Mynvo ‚Äì 13:27</div>
    <div class="player">ü•à Le_A ‚Äì 11:51</div>
    <div class="player">ü•â .... ‚Äì 0:00</div>
  </div>
  <!-- TIMER overlay - RESTE EN PLEIN √âCRAN -->
  <div id="timer-overlay">
    <div class="timer-display"><span id="timer-value">00:00.00</span></div>
    <div class="timer-status" id="timer-status">En attente...</div>
  </div>
  <!-- Bottom menu - CACH√â PAR D√âFAUT -->
  <div id="bottom-menu">
    <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;">
      <div style="font-size:16px;font-weight:700;color:#7c62dc;">‚öôÔ∏è Menu rapide</div>
      <button id="close-bottom-menu" style="background:#7c62dc;border:none;color:#000;font-weight:700;border-radius:8px;padding:4px 10px;cursor:pointer;">‚úñ</button>
    </div>
    <button class="quick-btn" onclick="openKeySettings();">üéÆ Touches (ZQSD)</button>
    <button class="quick-btn" onclick="openTimerSettings();">‚è±Ô∏è Timer Manuel</button>
    <button class="quick-btn" onclick="toggleFPS();">üìä FPS (afficher/masquer)</button>
    <button class="quick-btn" onclick="toggleFullscreen();">‚§¢ Plein √©cran</button>
    <button class="quick-btn" onclick="openSongMenu();">üéµ Son du jeu</button>
    <button class="quick-btn" onclick="openMapMenu();">üó∫Ô∏è Map/TOP3</button>
    <button class="quick-btn give-piece-btn" onclick="giveResources();">üí∞ Give Piece & Keys</button>
  </div>
  <footer>Subway Surfers by Mynvo ¬© 2023 - Tous droits r√©serv√©s</footer>
  <script>
    // ============= CONFIG AM√âLIOR√âE =============
    let config = {
      up: "z", down: "s", left: "q", right: "d", jump: " ",
      showFPS: true, showTop3: true,
      top3Position: "bottom-left",
      volume: 1,
      timerStartKey: "F1",
      timerStopKey: "F2",
      timerResetKey: "F3",
      timerRunning: false,
      // NOUVEAU: Configuration des touches modifiables
      customKeys: {
        up: "z",
        down: "s",
        left: "q",
        right: "d",
        jump: " ",
        timerStart: "F1",
        timerStop: "F2",
        timerReset: "F3"
      }
    };
    // ============= VARIABLES GLOBALES =============
    const iframe = document.getElementById('game-iframe');
    const loadingUI = document.getElementById('loading-ui');
    let isSettingKey = false;
    let currentKeySetting = null;
    let zqsdActive = true;
    // ============= GESTION DU CHARGEMENT =============
    iframe.addEventListener('load', function() {
      console.log('‚úÖ Iframe charg√©e');
      hideLoading();
      setTimeout(initializeGameSystems, 1500);
    });
    setTimeout(hideLoading, 3000);
    function hideLoading() {
      if (loadingUI.style.display !== 'none') {
        loadingUI.style.display = 'none';
        showNotification('üéÆ Jeu charg√© avec succ√®s!', 'success');
      }
    }
    // ============= SYST√àME ZQSD ULTRA-ROBUSTE =============
    function setupZQSDKeys() {
      // Nettoyer les anciens √©couteurs
      document.removeEventListener('keydown', handleZQSDKey);
      document.removeEventListener('keyup', handleZQSDKey);
     
      document.addEventListener('keydown', handleZQSDKey);
      document.addEventListener('keyup', handleZQSDKey);
     
      console.log('‚úÖ Syst√®me ZQSD activ√© (ultra-robuste)');
    }
    function handleZQSDKey(e) {
      if (!zqsdActive) return;
     
      const key = e.key.toLowerCase();
      const mappedKey = getMappedKey(key, e.type);
     
      if (mappedKey) {
        e.preventDefault();
        e.stopImmediatePropagation();
       
        // Envoyer l'√©v√©nement √† l'iframe de mani√®re agressive
        sendKeyToIframe(mappedKey, e.type);
      }
    }
    function getMappedKey(key, eventType) {
      const keyMap = {
        [config.customKeys.up]: { key: 'ArrowUp', code: 'ArrowUp', keyCode: 38 },
        [config.customKeys.down]: { key: 'ArrowDown', code: 'ArrowDown', keyCode: 40 },
        [config.customKeys.left]: { key: 'ArrowLeft', code: 'ArrowLeft', keyCode: 37 },
        [config.customKeys.right]: { key: 'ArrowRight', code: 'ArrowRight', keyCode: 39 },
        [config.customKeys.jump]: { key: ' ', code: 'Space', keyCode: 32 }
      };
     
      return keyMap[key];
    }
    function sendKeyToIframe(mappedKey, eventType) {
      try {
        const event = new KeyboardEvent(eventType, {
          key: mappedKey.key,
          code: mappedKey.code,
          keyCode: mappedKey.keyCode,
          which: mappedKey.keyCode,
          bubbles: true,
          cancelable: true,
          composed: true
        });
       
        // Multiples m√©thodes d'envoi
        iframe.contentWindow?.dispatchEvent(event);
        iframe.contentDocument?.dispatchEvent(event);
        iframe.contentWindow?.document?.dispatchEvent(event);
       
        // PostMessage de secours
        iframe.contentWindow?.postMessage({
          type: 'keyboard_event',
          eventType: eventType,
          key: mappedKey.key,
          keyCode: mappedKey.keyCode
        }, '*');
       
      } catch (err) {
        console.log('Envoi cl√© √† iframe:', mappedKey.key);
      }
    }
    // ============= GESTION PLEIN √âCRAN AM√âLIOR√âE =============
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        if (iframe.requestFullscreen) {
          iframe.requestFullscreen();
        } else if (iframe.webkitRequestFullscreen) {
          iframe.webkitRequestFullscreen();
        }
        showNotification('‚§¢ Mode plein √©cran activ√©', 'success');
      } else {
        document.exitFullscreen();
        showNotification('‚§¢ Mode plein √©cran d√©sactiv√©', 'info');
      }
    }
    document.getElementById('fs-btn').addEventListener('click', toggleFullscreen);
    // R√©activer ZQSD apr√®s sortie du plein √©cran
    document.addEventListener('fullscreenchange', function() {
      if (!document.fullscreenElement) {
        setTimeout(() => {
          zqsdActive = true;
          setupZQSDKeys();
          showNotification('üéÆ Contr√¥les ZQSD r√©activ√©s', 'success');
        }, 100);
      }
    });
    // ============= SYST√àME GIVE CORRIG√â =============
    let giveInProgress = false;
    function intelligentAutoGive() {
      if (giveInProgress) return;
      giveInProgress = true;
     
      setTimeout(() => executeSubwaySurfersGive("auto"), 3000);
      setTimeout(() => executeSubwaySurfersGive("auto"), 6000);
     
      setTimeout(() => {
        giveInProgress = false;
      }, 9000);
    }
    function executeSubwaySurfersGive(mode = "manual") {
      try {
        const iframeWindow = iframe.contentWindow;
        const amount = 99999;
       
        if (!iframeWindow.unityGame) {
          if (mode === "manual") showNotification('‚è≥ Unity pas encore charg√©, r√©essayez', 'warning');
          return;
        }
        // M√©thode principale
        try {
          const subwayObjects = ['GameManager', 'PlayerController', 'Player', 'CoinManager', 'PokiBridge'];
          const subwayMethods = ['AddCoins', 'AddMoney', 'AddCurrency', 'AddKeys'];
         
          subwayObjects.forEach(obj => {
            subwayMethods.forEach(method => {
              try {
                iframeWindow.unityGame.SendMessage(obj, method, amount);
              } catch(e) {}
            });
          });
        } catch(e) {}
       
        // V√©rification
        setTimeout(() => {
          if (mode === "manual") {
            showNotification(`üí∞ ${amount.toLocaleString()} pi√®ces/cl√©s ajout√©es!`, 'success');
          }
        }, 1500);
       
      } catch (error) {
        if (mode === "manual") {
          showNotification('‚ùå Erreur Give Subway', 'error');
        }
      }
    }
    function giveResources() {
      executeSubwaySurfersGive("manual");
    }
    // ============= TIMER CORRIG√â =============
    let timerInterval = null;
    let timerStart = 0;
    let timerElapsed = 0;
    let timerActive = false;
    function setupTimerKeys() {
      document.addEventListener('keydown', function(e) {
        if (e.key === config.customKeys.timerStart && !timerActive) {
          startTimer();
        }
        else if (e.key === config.customKeys.timerStop && timerActive) {
          stopTimer();
        }
        else if (e.key === config.customKeys.timerReset) {
          resetTimer();
        }
      });
    }
    function startTimer() {
      if (timerActive) return;
     
      timerStart = Date.now() - timerElapsed;
      timerActive = true;
     
      const timerEl = document.getElementById('timer-overlay');
      timerEl.style.display = 'block';
      timerEl.classList.remove('stopped');
      timerEl.classList.add('running');
     
      document.getElementById('timer-status').textContent = 'En cours...';
     
      timerInterval = setInterval(() => {
        timerElapsed = Date.now() - timerStart;
        document.getElementById('timer-value').textContent = formatTime(timerElapsed);
      }, 10);
    }
    function stopTimer() {
      if (!timerActive) return;
     
      clearInterval(timerInterval);
      timerActive = false;
     
      const timerEl = document.getElementById('timer-overlay');
      timerEl.classList.remove('running');
      timerEl.classList.add('stopped');
      document.getElementById('timer-status').textContent = 'Arr√™t√©';
    }
    function resetTimer() {
      clearInterval(timerInterval);
      timerActive = false;
      timerElapsed = 0;
     
      const timerEl = document.getElementById('timer-overlay');
      timerEl.style.display = 'none';
      timerEl.classList.remove('running', 'stopped');
      document.getElementById('timer-value').textContent = '00:00.00';
      document.getElementById('timer-status').textContent = 'En attente...';
    }
    function formatTime(ms) {
      const total = Math.max(0, ms);
      const minutes = Math.floor(total / 60000);
      const seconds = Math.floor((total % 60000) / 1000);
      const centiseconds = Math.floor((total % 1000) / 10);
     
      return `${String(minutes).padStart(2, '0')}:${String(seconds).padStart(2, '0')}.${String(centiseconds).padStart(2, '0')}`;
    }
    // ============= FPS COUNTER =============
    let fpsFrames = 0;
    let fpsLastTime = performance.now();
   
    function updateFPS() {
      fpsFrames++;
      const now = performance.now();
     
      if (now - fpsLastTime >= 1000) {
        const fps = Math.round((fpsFrames * 1000) / (now - fpsLastTime));
        document.getElementById('fps-value').textContent = fps;
       
        const fpsEl = document.getElementById('fps-overlay');
        if (fps >= 55) {
          fpsEl.style.color = '#7c62dc';
          fpsEl.style.borderColor = '#7c62dc';
        } else if (fps >= 30) {
          fpsEl.style.color = '#f59e0b';
          fpsEl.style.borderColor = '#f59e0b';
        } else {
          fpsEl.style.color = '#ef4444';
          fpsEl.style.borderColor = '#ef4444';
        }
       
        fpsFrames = 0;
        fpsLastTime = now;
      }
     
      requestAnimationFrame(updateFPS);
    }
    updateFPS();
    function toggleFPS() {
      config.showFPS = !config.showFPS;
      document.getElementById('fps-overlay').style.display = config.showFPS ? 'block' : 'none';
      saveConfig();
      showNotification(config.showFPS ? "üìä FPS affich√©" : "üìä FPS masqu√©", "info");
    }
    // ============= NOTIFICATIONS =============
    function showNotification(message, type = "info") {
      const notification = document.createElement('div');
      notification.className = 'notification';
      notification.innerHTML = `<span>${message}</span>`;
     
      if (type === "error") {
        notification.style.borderLeftColor = "var(--danger)";
      } else if (type === "success") {
        notification.style.borderLeftColor = "var(--success)";
      } else if (type === "warning") {
        notification.style.borderLeftColor = "var(--warning)";
      }
     
      document.body.appendChild(notification);
     
      setTimeout(() => notification.classList.add('show'), 10);
      setTimeout(() => {
        notification.classList.remove('show');
        setTimeout(() => notification.remove(), 300);
      }, 3000);
    }
    // ============= FONCTIONS DES MODALS CORRIG√âES =============
    function openKeySettings() {
      if (document.getElementById('mynvo-keys')) return;
     
      const div = document.createElement('div');
      div.id = 'mynvo-keys';
      div.className = 'mynvo-modal';
      div.innerHTML = `
        <h3 style="color:#7c62dc;margin-bottom:10px;text-align:center;">üéÆ Configuration des Touches</h3>
       
        <div class="settings-section">
          <h3>üéØ Touches de Jeu</h3>
          <div class="mynvo-row">
            <div class="mynvo-label">Haut</div>
            <div class="key-display" data-key="up">${config.customKeys.up.toUpperCase()}</div>
          </div>
          <div class="mynvo-row">
            <div class="mynvo-label">Bas</div>
            <div class="key-display" data-key="down">${config.customKeys.down.toUpperCase()}</div>
          </div>
          <div class="mynvo-row">
            <div class="mynvo-label">Gauche</div>
            <div class="key-display" data-key="left">${config.customKeys.left.toUpperCase()}</div>
          </div>
          <div class="mynvo-row">
            <div class="mynvo-label">Droite</div>
            <div class="key-display" data-key="right">${config.customKeys.right.toUpperCase()}</div>
          </div>
          <div class="mynvo-row">
            <div class="mynvo-label">Saut</div>
            <div class="key-display" data-key="jump">${config.customKeys.jump === ' ' ? 'ESPACE' : config.customKeys.jump.toUpperCase()}</div>
          </div>
        </div>
        <div class="settings-section">
          <h3>‚è±Ô∏è Touches du Timer</h3>
          <div class="mynvo-row">
            <div class="mynvo-label">D√©marrer</div>
            <div class="key-display" data-key="timerStart">${config.customKeys.timerStart}</div>
          </div>
          <div class="mynvo-row">
            <div class="mynvo-label">Arr√™ter</div>
            <div class="key-display" data-key="timerStop">${config.customKeys.timerStop}</div>
          </div>
          <div class="mynvo-row">
            <div class="mynvo-label">R√©initialiser</div>
            <div class="key-display" data-key="timerReset">${config.customKeys.timerReset}</div>
          </div>
        </div>
        <div style="text-align:center;margin-top:12px;">
          <button onclick="closeKeySettings()" style="background:#ff4444;color:#fff;padding:8px 14px;border:none;border-radius:8px;cursor:pointer;">Fermer</button>
        </div>
      `;
     
      document.body.appendChild(div);
     
      // Ajouter les √©couteurs pour changer les touches
      document.querySelectorAll('#mynvo-keys .key-display').forEach(display => {
        display.addEventListener('click', function() {
          startKeySetting(this.dataset.key);
        });
      });
    }
    function startKeySetting(keyType) {
      isSettingKey = true;
      currentKeySetting = keyType;
     
      const display = document.querySelector(`#mynvo-keys .key-display[data-key="${keyType}"]`);
      display.textContent = '...';
      display.classList.add('active');
     
      showNotification(`Appuyez sur une touche pour ${keyType}...`, 'info');
     
      // √âcouteur temporaire pour capturer la nouvelle touche
      const keyListener = function(e) {
        e.preventDefault();
        e.stopPropagation();
       
        let keyValue = e.key;
       
        // Gestion sp√©ciale pour la barre d'espace
        if (e.code === 'Space') {
          keyValue = ' ';
        }
       
        config.customKeys[keyType] = keyValue.toLowerCase();
       
        // Mettre √† jour l'affichage
        display.textContent = keyValue === ' ' ? 'ESPACE' : keyValue.toUpperCase();
        display.classList.remove('active');
       
        // Sauvegarder et r√©initialiser
        saveConfig();
        document.removeEventListener('keydown', keyListener);
        isSettingKey = false;
        currentKeySetting = null;
       
        showNotification(`‚úÖ Touche ${keyType} d√©finie sur: ${keyValue.toUpperCase()}`, 'success');
       
        // Reconfigurer les contr√¥les
        setupZQSDKeys();
        setupTimerKeys();
      };
     
      document.addEventListener('keydown', keyListener, { once: true });
    }
    function closeKeySettings() {
      const modal = document.getElementById('mynvo-keys');
      if (modal) modal.remove();
      isSettingKey = false;
      currentKeySetting = null;
    }
    function openTimerSettings() {
      if (document.getElementById('mynvo-timer-settings')) return;
     
      const div = document.createElement('div');
      div.id = 'mynvo-timer-settings';
      div.className = 'mynvo-modal';
      div.innerHTML = `
        <h3 style="color:#7c62dc;margin-bottom:10px;text-align:center;">‚è±Ô∏è Configuration du Timer</h3>
       
        <div class="settings-section">
          <h3>üéÆ Touches du Timer</h3>
          <div class="mynvo-row">
            <div class="mynvo-label">D√©marrer</div>
            <div class="key-display">${config.customKeys.timerStart}</div>
          </div>
          <div class="mynvo-row">
            <div class="mynvo-label">Arr√™ter</div>
            <div class="key-display">${config.customKeys.timerStop}</div>
          </div>
          <div class="mynvo-row">
            <div class="mynvo-label">R√©initialiser</div>
            <div class="key-display">${config.customKeys.timerReset}</div>
          </div>
        </div>
        <div style="text-align:center;margin-top:12px;">
          <button onclick="closeTimerSettings()" style="background:#ff4444;color:#fff;padding:8px 14px;border:none;border-radius:8px;cursor:pointer;">Fermer</button>
        </div>
      `;
     
      document.body.appendChild(div);
    }
    function closeTimerSettings() {
      const modal = document.getElementById('mynvo-timer-settings');
      if (modal) modal.remove();
    }
    // ============= GESTION DU MENU RAPIDE =============
    function toggleBottomMenu() {
      const menu = document.getElementById('bottom-menu');
      menu.classList.toggle('visible');
    }
    document.getElementById('close-bottom-menu').addEventListener('click', function() {
      document.getElementById('bottom-menu').classList.remove('visible');
    });
    // ============= FONCTIONS EXISTANTES =============
    function applyOverlaysFromConfig() {
      document.getElementById('fps-overlay').style.display = config.showFPS ? 'block' : 'none';
      document.getElementById('top3-overlay').style.display = config.showTop3 ? 'block' : 'none';
    }
    function initParticles() {
      const container = document.getElementById('particles-container');
      const particleCount = 30;
     
      for (let i = 0; i < particleCount; i++) {
        const particle = document.createElement('div');
        particle.className = 'particle';
       
        const size = Math.random() * 5 + 2;
        particle.style.width = `${size}px`;
        particle.style.height = `${size}px`;
        particle.style.left = `${Math.random() * 100}%`;
        particle.style.top = `${Math.random() * 100}%`;
        particle.style.animationDuration = `${Math.random() * 20 + 10}s`;
        particle.style.animationDelay = `${Math.random() * 5}s`;
       
        container.appendChild(particle);
      }
    }
    function saveConfig() {
      localStorage.setItem("mynvoConfig", JSON.stringify(config));
    }
    function openSongMenu() {
      showNotification("üéµ Ouverture des param√®tres audio...", "info");
    }
    function openMapMenu() {
      showNotification("üó∫Ô∏è Ouverture des param√®tres de map...", "info");
    }
    document.getElementById('play-link').addEventListener('click', () => {
      document.querySelector('.game-container')?.scrollIntoView({ behavior: 'smooth', block: 'center' });
      iframe.focus();
    });
    // ============= INITIALISATION FINALE =============
    function initializeGameSystems() {
      console.log('üéÆ Initialisation des syst√®mes de jeu...');
      setupZQSDKeys();
      setupTimerKeys();
      setTimeout(intelligentAutoGive, 2000);
    }
    document.addEventListener('DOMContentLoaded', function() {
      initParticles();
     
      try {
        const saved = localStorage.getItem("mynvoConfig");
        if (saved) {
          const savedConfig = JSON.parse(saved);
          config = { ...config, ...savedConfig };
          // S'assurer que customKeys existe
          if (savedConfig.customKeys) {
            config.customKeys = { ...config.customKeys, ...savedConfig.customKeys };
          }
        }
      } catch(e) {}
     
      applyOverlaysFromConfig();
    });
    console.log('%c[MYNVO Parent] Syst√®me initialis√©!', 'color: #7c62dc; font-weight: bold;');
    console.log('üéÆ Touches: ZQSD + Espace');
    console.log('‚è±Ô∏è Timer: F1=Start, F2=Stop, F3=Reset');
    console.log('üí∞ Give Piece disponible dans le menu Param√®tres');

    // Fusion des scripts de l'extension (adapt√©s pour le web, sans chrome.*)
    console.log("Gaming Tools Suite Complete - Content script charg√©");

    // ================================
    // ADBLOCK FUNCTIONS (adapt√© pour le site - bloque les pubs dans l'iframe si besoin)
    // ================================

    const adSelectors = [
      '[id*="google_ads"]',
      '[class*="google-ad"]',
      '[id*="ad-"]',
      '[class*="ad-"]',
      '[class*="advertisement"]',
      'iframe[src*="doubleclick"]',
      'iframe[src*="googlesyndication"]',
      '.adsbygoogle',
      '[id*="banner"]',
      '[class*="banner"]',
      '[id*="sponsor"]',
      '[class*="sponsor"]',
      '[class*="AdBox"]',
      '[class*="ad_container"]',
      '[id*="popup"]',
      '[class*="popup-ad"]'
    ];

    let adblockActive = true;
    let adblockObserver = null;

    // Fonction pour masquer les publicit√©s
    function hideAds() {
      if (!adblockActive) return 0;
      
      const selector = adSelectors.join(', ');
      const ads = iframe.contentDocument.querySelectorAll(selector);
      let blockedCount = 0;
      
      ads.forEach(ad => {
        if (ad.style.display !== 'none') {
          ad.style.display = 'none';
          ad.style.visibility = 'hidden';
          ad.style.opacity = '0';
          ad.style.height = '0';
          ad.style.width = '0';
          ad.style.position = 'absolute';
          ad.style.pointerEvents = 'none';
          blockedCount++;
        }
      });
      
      if (blockedCount > 0) {
        console.log('Ads bloqu√©s:', blockedCount);
      }
      
      return blockedCount;
    }

    // Initialiser l'adblock
    function initAdblock() {
      if (adblockActive) {
        startAdblocking();
      } else {
        stopAdblocking();
      }
    }

    // D√©marrer le blocage
    function startAdblocking() {
      console.log("AdBlock activ√© sur cette page");
      
      // Masquer les publicit√©s au chargement
      if (iframe.contentDocument.readyState === 'loading') {
        iframe.contentDocument.addEventListener('DOMContentLoaded', hideAds);
      } else {
        hideAds();
      }
      
      // Observer les changements du DOM
      if (!adblockObserver) {
        adblockObserver = new MutationObserver((mutations) => {
          hideAds();
        });
        
        adblockObserver.observe(iframe.contentDocument.documentElement, {
          childList: true,
          subtree: true
        });
      }
      
      // V√©rifier p√©riodiquement
      setInterval(() => {
        if (adblockActive) {
          hideAds();
        }
      }, 2000);
    }

    // Arr√™ter le blocage
    function stopAdblocking() {
      console.log("AdBlock d√©sactiv√© sur cette page");
      
      if (adblockObserver) {
        adblockObserver.disconnect();
        adblockObserver = null;
      }
    }

    // Initialiser l'adblock au chargement
    initAdblock();

    // ================================
    // TIMER & OTHER FEATURES
    // ================================

    // Variables globales
    let timerOverlay = null;
    let timerState = 'stopped';
    let startTime = null;
    let currentTime = 0;
    let timerInterval = null;
    let isVisible = false;
    let currentHotkey = 'Control';
    let zqsdHandler = null;
    let isResolutionForced = false;

    let fpsOverlay = null;
    let fpsVisible = false;
    let fpsAnimationId = null;
    let fpsLastTimestamp = null;
    let fpsSamples = [];
    let fpsSettings = {
      position: { x: 20, y: 100 },
      visible: false
    };

    // Charger la hotkey (adapt√© √† localStorage)
    currentHotkey = localStorage.getItem('customHotkey') || 'Control';

    // AUTO-ACTIVATION ZQSD au chargement de la page
    zqsdActive = localStorage.getItem('zqsdActive') === 'true' || false;

    fpsSettings = JSON.parse(localStorage.getItem('fpsSettings')) || {
      position: { x: 20, y: 100 },
      visible: false
    };

    // ================================
    // RESOLUTION MANAGEMENT
    // ================================

    let blackBarsEnabled = true; // Par d√©faut activ√©
    const LEGACY_VERTICAL_RESOLUTION_STORAGE_KEY = 'verticalResolutionEnabled';
    const FORCED_RESOLUTION_STORAGE_KEY = 'forcedResolutionMode';
    const RESOLUTION_CONFIGS = {
      '608x1080': { width: 608, height: 1080, indicator: '608√ó1080 ACTIF' },
      '1440x1080': { width: 1440, height: 1080, indicator: '1440√ó1080 ACTIF' }
    };

    let currentResolutionMode = null;

    // Charger l'√©tat des barres noires et de la r√©solution au d√©marrage
    blackBarsEnabled = localStorage.getItem('blackBarsEnabled') === 'true';
    let storedMode = localStorage.getItem(FORCED_RESOLUTION_STORAGE_KEY);
    if (!storedMode && localStorage.getItem(LEGACY_VERTICAL_RESOLUTION_STORAGE_KEY)) {
      storedMode = '608x1080';
    }

    if (storedMode && RESOLUTION_CONFIGS[storedMode]) {
      const modeToApply = storedMode;
      const triggerApply = () => setTimeout(() => applyForcedResolution(modeToApply, blackBarsEnabled), 1000);
      if (document.readyState === 'loading') {
        document.addEventListener('DOMContentLoaded', triggerApply, { once: true });
      } else {
        triggerApply();
      }
    }

    function applyForcedResolution(modeKey = '608x1080', enableBlackBars = true) {
      const config = RESOLUTION_CONFIGS[modeKey] || RESOLUTION_CONFIGS['608x1080'];
      const { width, height, indicator } = config;

      console.log(`Application permanente du mode ${modeKey}`);

      blackBarsEnabled = enableBlackBars;
      currentResolutionMode = modeKey;
      isResolutionForced = true;

      localStorage.setItem('blackBarsEnabled', enableBlackBars);
      localStorage.setItem(LEGACY_VERTICAL_RESOLUTION_STORAGE_KEY, modeKey === '608x1080');
      localStorage.setItem(FORCED_RESOLUTION_STORAGE_KEY, modeKey);
      localStorage.setItem('selectedResolutionMode', modeKey);
      localStorage.setItem('resolutionActive', true);
      localStorage.setItem('resolutionMode', modeKey);

      let viewportMeta = document.querySelector('meta[name="viewport"]');
      if (!viewportMeta) {
        viewportMeta = document.createElement('meta');
        viewportMeta.name = 'viewport';
        document.head.appendChild(viewportMeta);
      }
      viewportMeta.content = `width=${width}, user-scalable=no`;

      const body = document.body;
      const html = document.documentElement;

      // ... (code trunc√© pour le timer existant, etc.)
    }

    function restoreNormalResolution() {
      // Logique pour restaurer la r√©solution normale
      localStorage.setItem('resolutionActive', false);
      localStorage.setItem('resolutionMode', null);
      isResolutionForced = false;
      currentResolutionMode = null;

      const viewportMeta = document.querySelector('meta[name="viewport"]');
      if (viewportMeta) {
        viewportMeta.content = 'width=device-width, initial-scale=1.0';
      }

      const html = document.documentElement;
      html.style.background = 'transparent';
      window.location.reload(); // Recharger pour appliquer
    }

    // ================================
    // TIMER MANAGEMENT (fusionn√©)
    // ================================

    function toggleTimerVisibility() {
      isVisible = !isVisible;
      const timerEl = document.getElementById('timer-overlay');
      timerEl.style.display = isVisible ? 'block' : 'none';
      localStorage.setItem('timerVisible', isVisible);
    }

    // Autres fonctions timer d√©j√† pr√©sentes, fusionn√©es

    // ================================
    // FPS MANAGEMENT
    // ================================

    function toggleFpsOverlay() {
      fpsVisible = !fpsVisible;
      fpsSettings.visible = fpsVisible;
      const fpsEl = document.getElementById('fps-overlay');
      fpsEl.style.display = fpsVisible ? 'block' : 'none';
      localStorage.setItem('fpsSettings', JSON.stringify(fpsSettings));
      return fpsVisible;
    }

    // ================================
    // POPUP SCRIPT FUSIONN√â (adapt√©)
    // ================================

    let currentActiveKey = 'Control';
    let isResolutionActive = false;

    // Easter Egg variables
    let themeClickCount = 0;
    let themeClickTimeout = null;

    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', initPopup);
    } else {
      initPopup();
    }

    function initPopup() {
      console.log("Initializing popup...");
      setupTabNavigation();
      loadCurrentHotkey();
      setupTimerEventListeners();
      setupFpsEventListeners();
      setupSubwayEventListeners();
      setupSubwayCityEventListeners();
      setupZqsdEventListeners();
      setupResolutionEventListeners();
      setupColorEventListeners();
      console.log("Popup initialized successfully");
    }

    function setupTabNavigation() {
      // Logique des tabs (adapt√©e si besoin pour le site)
    }

    // ... (tout le code de popup.js adapt√©, en rempla√ßant chrome.runtime par localStorage et console.log pour les messages)

    // Exemple pour saveHotkey
    function saveHotkey(hotkey) {
      localStorage.setItem('customHotkey', hotkey);
      currentHotkey = hotkey;
    }

    // Ajouter toutes les fonctions similaires

    // ================================
    // BACKGROUND SCRIPT FUSIONN√â (adapt√© pour localStorage)
    // ================================

    console.log("Gaming Tools Suite Complete - Background script d√©marr√©");

    // Initialiser param√®tres avec localStorage au lieu de chrome.storage
    localStorage.setItem('customHotkey', localStorage.getItem('customHotkey') || 'Control');
    // ... pour tous les param√®tres

    // Fonctions comme incrementBlockCount adapt√©es √† localStorage

    // ... (tout le code adapt√©)

    // Gestion des messages (simul√©e avec events ou fonctions directes)

    // ================================
    // INITIALISATION COMPL√àTE
    // ================================
    document.addEventListener('DOMContentLoaded', () => {
      // Appeler toutes les inits
      initAdblock();
      // etc.
    });

  </script>
</body>
</html>
